open biol open biol rsob royopenbio open biology 2046 - 2441 the royal society 28202626 5356442 10.1098 / rsob.160283 rsob160283 100133181researchresearch article cancer cells exhibit clonal diversity in phenotypic plasticity diversity in phenotypic plasticity http :// orcid.org / 0000 - 0001 - 8572 - 4734 mathis robert austin 12 http :// orcid.org / 0000 - 0002 - 2988 - 0537 sokol ethan s .
12 http :// orcid.org / 0000 - 0002 - 9703 - 1780 gupta piyush b .
1234 1 whitehead institute for biomedical research , 455 main street , cambridge , ma 02142 , usa 2 department of biology , massachusetts institute of technology , cambridge , ma 02139 , usa 3 koch institute for integrative cancer research at mit , cambridge , ma 02139 , usa 4 harvard stem cell institute , cambridge , ma 02138 , usa e - mail : pgupta @ wi.mit.edu electronic supplementary material is available online at https :// dx.doi.org / 10.6084 / m9.figshare.c.3683164 .
2 2017 15 2 2017 15 2 2017 7 2 160283 10 10 2016 25 1 2017 ( c ) 2017 the authors .
2017 published by the royal society under the terms of the creative commons attribution license http :// creativecommons.org / licenses / by / 4.0 / , which permits unrestricted use , provided the original author and source are credited .
phenotypic heterogeneity in cancers is associated with invasive progression and drug resistance .
this heterogeneity arises in part from the ability of cancer cells to switch between phenotypic states , but the dynamics of this cellular plasticity remain poorly understood .
here we apply dna barcodes to quantify and track phenotypic plasticity across hundreds of clones in a population of cancer cells exhibiting epithelial or mesenchymal differentiation phenotypes .
we find that the epithelial - to - mesenchymal cell ratio is highly variable across the different clones in cancer cell populations , but remains stable for many generations within the progeny of any single clone - - with a heritability of 0.89 .
to estimate the effects of combination therapies on phenotypically heterogeneous tumours , we generated quantitative simulations incorporating empirical data from our barcoding experiments .
these analyses indicated that combination therapies which alternate between epithelial - and mesenchymal - specific treatments eventually select for clones with increased phenotypic plasticity .
however , this selection could be minimized by increasing the frequency of alternation between treatments , identifying designs that may minimize selection for increased phenotypic plasticity .
these findings establish new insights into phenotypic plasticity in cancer , and suggest design principles for optimizing the effectiveness of combination therapies for phenotypically heterogeneous tumours .
phenotypic plasticity tumour heterogeneity cell state clonal evolution national science foundationhttp :// dx.doi.org / 10.13039 / 1000000011122374national institutes of healthhttp :// dx.doi.org / 10.13039 / 1000000022t32gm007287 - 36richard and susan smith family foundationhttp :// dx.doi.org / 10.13039 / 100001341breast cancer alliancehttp :// dx.doi.org / 10.13039 / 100001513cover - datefebruary 2017 1 .
background the diversity of cancer cell phenotypes within individual tumours plays a major role in driving both drug resistance and tumour progression [ 1,2 ] .
for decades , the prevailing view has been that phenotypic diversity arises because tumours are mixtures of cancer cell clones with distinct yet heritable phenotypes .
in this neo - darwinian model , cancer cell phenotypes are genetically encoded and thus stably propagated to daughter cells [ 3 - 6 ] .
in support of this model , there are significant genetic differences between different sections of a tumour , and even across different cells from the same tumours [ 5 - 9 ] .
phenotypic heterogeneity has been documented in breast tumours and breast cancer cell lines [ 10,11 ] .
several recent reports have suggested that there are bi - directional transitions between cancer cells in distinct phenotypic states for various kinds of cancers [ 12 - 22 ] .
for example , breast cancer cells in culture transition between mesenchymal ( stem - like ) and epithelial ( differentiated ) states [ 12 - 14,16,17,23 ] .
analyses of cells within patient tumours also suggest that they transition between phenotypic states [ 18,24 ] .
in any population , random transitions of cells between phenotypic states will give rise to a stable equilibrium in which the different phenotypic states are represented at fixed proportions [ 12 ] .
since phenotypic plasticity has primarily been examined in populations of cancer cells , it is currently not known if this trait varies across the different cancer cell clones within a single population .
genetic analyses of phenotype states sorted from tumours and cell lines have led to conflicting conclusions regarding the contribution of genetic mutations to phenotypic plasticity [ 24 - 27 ] .
while some studies have confirmed clonal relationships between states , a key question that remains open is if phenotypic plasticity can vary across the clones in a single cancer cell population [ 28 ] .
resolving this question - - whether the clonal diversity of cancers influences their phenotypic plasticity - - is fundamental to understanding cancer , and is also important from the perspective of developing combination cancer therapies .
in particular , optimal combination chemotherapy designs will depend on whether the clones in a tumour have different capacities to transition between drug - sensitive and - resistant states .
examining this question would require an experimental approach that can quantify phenotypic plasticity in hundreds of individual clones within a population of cancer cells .
dna barcodes combined with high - throughput sequencing have proven effective for tracking large numbers of clones in both normal and cancer cell populations [ 28 - 30 ] .
here , we apply dna barcodes to quantify the extent to which phenotypic plasticity varies across hundreds of clones within a single population of cancer cells .
2. results 2.1 .
labelling of cancer cell clones with dna barcodes to track the progeny of single cancer cells , we used retroviruses to stably introduce a random dna sequence ( or barcode ) into their genome .
these barcodes were introduced into 1 x 104 mda - mb - 157 cells at a low multiplicity of infection ( 0.13 ) , which we expected would label approximately 1300 individual clones ( electronic supplementary material , figure s1a ) .
after a brief drug selection for the infected cells , the barcoded clones were expanded in culture over a span of several months ( figure 1 ) .
since the retrovirus pool contains approximately 2.6 x 106 random barcodes ( electronic supplementary material , figure s1b ) , and only approximately 1300 cells were infected , there was a probability of 0.31 that more than one cell was independently infected with the same barcode , and a probability of 6.1 x 10 - 3 that four or more cells shared a barcode with other cells ( electronic supplementary material , figure s1c ) .
accordingly , the number of copies of a given barcode sequence in the genomic dna is directly proportional to the size of the corresponding clone in the population .
figure 1 .
dna barcode strategy to examine plasticities across clones .
dna barcodes , stably introduced into cells , can be used to track the progeny of individual cells .
sorting these cells , and quantifying the abundance of each barcode in both cell states , will distinguish if clones vary in phenotypic plasticity .
included in the schematic is a sanger sequence trace of the pool of barcode plasmids .
high - throughput sequencing of the barcodes from the pool of clones revealed that the barcodes were well - separated in dna sequence space , with an average pair - wise hamming distance of 10.5 base pairs .
this is consistent with what one would expect if 1372 dna sequences of length 14 were randomly sampled from a space of 300 million possible sequences .
since the barcodes were well - separated in sequence space , it was straightforward to map reads to barcodes even in cases where point mutations arose through sequencing , consistent with the findings of others [ 28,31,32 ] ; such reads were an average of 1.7 base pairs from their parent barcodes .
2.2 .
clones have heterogeneous phenotypic ratios we chose to barcode the mda - mb - 157 cell line because this line contains both epithelial and mesenchymal phenotypic states that can be robustly separated by fluorescence - activated cell sorting ( facs ) .
using an antibody that recognizes keratins 8 and 18 , intracellular antigens which mark luminal epithelial cells in the mammary gland [ 33 ] , we were able to separate the cells into keratin 8 / 18 high or low fractions ( electronic supplementary material , figure s2a,b ) .
importantly , this population of cells also contained roughly equal amounts of the two phenotypic states , with about 40 % mesenchymal cells .
having a large minor population meant we were confident we could accurately detect clones with small amounts of progeny in the minor state .
to assess the proportion of cells with epithelial or mesenchymal phenotypes within each clone , we separated the barcoded population into epithelial and mesenchymal fractions with facs ( figure 1 ) .
to assess clonal dynamics , the same population of cells was sampled once weekly for a total of three time points , each time separating these phenotypes ( figure 2a ) .
after sorting , each population was further divided into equal halves before extracting and sequencing its dna .
using high - throughput sequencing , we quantified the proportion of cells with epithelial and mesenchymal phenotypes for each of the 1372 barcoded clones in the population .
figure 2 .
phenotypic plasticity varies across clones .
( a ) cells stably transduced with dna barcodes were expanded over approximately 1 month into a large population .
three times over 2 weeks , samples of the population were sorted by cell state , and each clone 's representation was quantified in these sorted states .
( b ) the fraction of each clone in the epithelial state ( fraction epithelial ) is plotted for each time point , showing the diversity of phenotypic plasticities among clones .
clones are sorted in ascending order by their fraction epithelial , calculated from the mean clone size in duplicate sorts .
( c ) histograms of clones , binned by the fraction of each clone that is epithelial , show the distribution of clonal plasticity .
each plot is from a different time point .
( d ) histogram of clones binned by their log2 ratio of epithelial ( e ) to mesenchymal ( m ) cells ( log2 ( e / m )) , with one plot for each time point , showing phenotypic plasticity is approximately log normally distributed across clones .
( e ) quantile / quantile plot with the distribution of log2 ( e / m ) across clones plotted against the quantiles of a normal distribution with the same mean and standard deviation , with one line for each time point .
also plotted is the line y = x ( dashed line ) , representing a perfect normal distribution .
( f ) each clone 's log2 ( e / m ) in one time point plotted against its log2 ( e / m ) in another time point , showing that clones have stable phenotypic plasticity .
the r2 ( squared pearson correlation coefficient ) is shown , and a linear regression of the data is plotted in blue .
each clone 's log2 ( e / m ) was calculated from the mean clone size in duplicate sorted e and m states .
to estimate the magnitude of the technical error associated with sample preparation , sequencing and analysis , we compared estimated clone sizes between each of the two sequenced partitions of these six populations ( two sorted populations at three time points ) .
the clone size estimated for each barcode was highly reproducible between these technical replicates , with an average pearson correlation of 0.9119 across the 1372 clones detected ( electronic supplementary material , figure s1d ) .
these observations indicated that this experimental approach reproducibly quantified the numbers of cells corresponding to barcoded clones within the population .
ordering clones by their fraction of epithelial cells revealed that the majority of clones produced progeny that were mixtures of cancer cells in the two phenotypic states ( figure 2b , electronic supplementary material , table s1 ) , with only 11 % of clones consisting of only one lineage ( statistically indistinguishable from mis - sorted cells ) .
although most clones exhibited such phenotypic plasticity , the ratio of epithelial to mesenchymal phenotypes varied significantly between clones ( shannon entropy = 3.5 ). from the sequencing data we were able to distinguish three distinct classes of clones : clones with mostly epithelial cells , clones with mostly mesenchymal cells , and clones that were a mixture of cells in these two phenotypic states ( figure 2c ) .
the majority of clones ( 89 %) in the population gave rise to daughter cells in both the mesenchymal and epithelial states , with slightly more than half of the clones ( 64 %) having a mesenchymal bias .
we observed that the distribution of epithelial - to - mesenchymal ratios across clones was closely approximated by a log - normal distribution ( figure 2d,e ) , for all three time points .
while most clones comprised both epithelial and mesenchymal cells , the proportion of progeny in these two states varied greatly between clones : 93 % of clones had a bias significantly different from the bulk population proportions of the two states .
although most clones had a mesenchymal bias , epithelial - biased clones tended to be larger ( electronic supplementary material , figure s3a ) , resulting in approximately 60 % of the population of cells being epithelial .
despite this difference , there was only a weak correlation ( 0.06 ) between a clone 's growth rate and log2 ( e / m ) ratio , although we found the differences in clones' growth rates to be stable across the time course ( electronic supplementary material , figure s3b - d ) .
2.3 .
phenotypic ratios are stably inherited by clonal progeny although phenotypic ratios varied significantly across clones , they were highly stable for any given clone during the 2 weeks in culture , with an average pearson correlation of 0.89 ( r2 = 0.79 , all p < 1 x 10 - 6 ) ( figure 2f ) .
additionally , 81 % of clones' fraction epithelial differed by less than 0.15 over 2 weeks .
this raised the possibility that the epithelial - to - mesenchymal ratio could be a quantitatively inherited phenotype .
to quantify the narrow - sense heritability of this trait , we generated 28 clonal subpopulations from individual cells expanded in culture over a span of 6 weeks .
after expanding these clonal subpopulations , we used sanger sequencing to determine their dna barcodes .
we also used flow cytometry to determine the phenotypic ratio in each of the cloned subpopulations , and compared this with the phenotypic ratio of the same clone in the parental pooled population ( figure 3a , electronic supplementary material , figure s4 and table s2 ) .
regression analysis of these comparisons indicated that phenotypic plasticity was a highly heritable trait ( rho = 0.89 ) ( figure 3b ) .
this heritability was considerably higher than that observed with 106 datasets with permutated barcode labels that randomized the relationship between the parental and cloned populations ( figure 3c ) .
this finding indicated that phenotypic plasticities were stably inherited even through the rigors of single - cell cloning .
figure 3 .
phenotypic plasticity is stably inherited .
( a ) clonal subpopulations were generated from single cells , and each clone 's phenotypic ratio was evaluated with flow cytometry .
( b ) each single - cell clone 's log2 ratio of epithelial to mesenchymal cells ( log2 ( e / m )) is plotted against the log2 ( e / m ) of the same clone in the parental pooled population .
the pearson correlation coefficient is shown , estimating the narrow - sense heritability .
in black is a linear regression of the data .
phenotypic ratio is a heritable phenotype .
( c ) barcode labels were randomized 106 times , and the pearson correlation was calculated for each iteration ; the observed correlation ( blue circle ) was higher than all of the randomizations , suggesting the heritability of phenotypic ratio is not likely due to random chance .
2.4 .
phenotypic plasticity varies across clones in primary tumours to assess whether phenotypic plasticity varies across clones in patient tumours , we analysed data from a recently published study that performed rna sequencing on single primary tumour cells [ 18 ]. by identifying clonal relationships between cells , and determining cell states , we could test whether these clones also had different cell - state proportions .
to identify clonal relationships , we looked for chromosomal gains and losses using a sliding average of gene expression moving across chromosomes , modified from published methods [ 18,34 ] .
although this limited resolution of genetic aberrations means we are likely to be missing genetic differences between clustered cells , we are confident the gains and losses of whole chromosomes reveal distinct clones .
this analysis revealed a common gain in chromosome 7 and loss of chromosome 10 across tumour cells , aberrations commonly found in glioblastoma [ 35 ] , as well as other changes , such as a gain of chromosome 5 or a loss of chromosome 14 or 13 , that were only present in some cells ( figure 4 ) .
hierarchical clustering grouped single cells into clones based on these inferred chromosomal gains and losses , resulting in four major clones ( figure 4 ) .
figure 4 .
phenotypic plasticity varies across clones in vivo .
at the top is a heat map of copy - number variation of single cells estimated from single - cell rna sequencing data of a primary glioblastoma [ 18 ] .
shown is a heatmap of the averaged , normalized expression of a sliding window of 100 genes moving across chromosomes , revealing chromosomal gains and losses .
each value shows the estimated log2 ( copy number / 2 ) for genes in the window .
based on these data , clones were grouped by hierarchical clustering based on ward clustering of the euclidean distances between clones , shown above .
below , each cell was given a score based on the average expression of a set of classifier genes for different tumour subtypes [ 35 ] and a score for glioblastoma stemness [ 18 ] , shown as a heatmap .
cl , classical ; nl , neural ; pn , proneural ; stem , stem - like ; mes , mesenchymal .
kruskal - wallis tests showed differential representation of the mesenchymal ( mes ) subtype ( p < 6 x 10 - 5 ) and the stemness score ( stem ) ( p < 8 x 10 - 4 ) among clones .
at the bottom , each cell 's subtype scores are evaluated for significance compared with the background of gene expression in that cell .
scores higher or lower than 95 % of gene sets were marked as enriched or depleted .
we used the same single - cell rna sequencing data to assign cells to cell states , using a published method based on the mean expression of gene sets defining different glioblastoma subtypes [ 18,35 ] , and increased ' stemness' [ 18 ] ( figure 4 ) .
this analysis revealed that while each clone contained cells representing different glioblastoma subtypes , there were significant differences in subtype scores between clones , particularly of the mesenchymal subtype ( p < 6 x 10 - 5 ) and a stem - like state ( p < 8.0 x 10 - 4 ) .
although this snapshot in time cannot tell us about the stability of these differences , this result suggests that clones within primary tumours have different cell - state proportions , consistent with our previous observations .
2.5 .
combination chemotherapies enrich for clones with increased phenotypic plasticity while there is significant interest in developing combination therapies that incorporate agents which selectively target the epithelial and mesenchymal states , the optimal design of such therapies is likely to depend on the mechanisms that give rise to phenotypic diversity in tumours .
we therefore used computational simulations to model how such chemotherapies would affect tumours that are heterogeneous mixtures of clones with different phenotypic plasticities .
these tumours were simulated to match the plasticities , sizes and growth rates of the observed clones .
as expected , treatment with an epithelial - specific chemotherapy enriched for the more - mesenchymal clones , whereas treatment with a mesenchymal - specific chemotherapy enriched for the more - epithelial clones ; both treatments selected for clones with reduced phenotypic plasticity .
in contrast , a combination therapy that sequentially applied the epithelial - and mesenchymal - specific treatments enriched for clones with increased phenotypic plasticity , with a maximal enrichment for clones that were equal mixtures of cells in the epithelial and mesenchymal states ( figure 5a ) .
in addition to selecting for clones with increased plasticity , this combination therapy was also significantly more effective at reducing tumour burden relative to either monotherapy ( 11 - to 23 - fold ; figure 5a ) .
figure 5 .
combination chemotherapy enriches for clones with increased phenotypic plasticity .
simulations of clones treated with different patterns of combination therapies that include mesenchymal - specific ( blue squares ) and epithelial - specific treatments ( black squares ) ( see material and methods ) .
( a - d ) left , the median fold change in clone size during the course of treatment for clones binned by the fraction of their progeny in the epithelial state .
displayed is the median and 90 % - 10 % range of observed medians across 500 simulations .
right , the number of cancer cells surviving at the end of the simulation for each treatment ; displayed is the median and 90 % - 10 % range of observed cell numbers across 500 simulations .
( a ) combination therapy ( orange curve ) enriches for clones with increased plasticity , while monotherapies enrich for clones in predominantly one or the other state .
fewer cells survive combination therapy .
( b ) increasing the cycles of combination therapies ( as shown in ( a )) further enriches for clones with increased plasticity .
however , resistant populations eventually emerge .
the number of cycles of each combination therapy is indicated .
( c ) different patterns of combination therapy , with varying proportions of epithelial - and mesenchymal - specific treatments , enrich for different , particular plasticities .
( d ) more rapid alternation between therapies reduces the enrichment for more plastic clones and more effectively reduces cancer cell numbers .
repeated alternating therapy also prevents the outgrowth of resistant clones , in contrast to repeated sequential therapy .
the number of cycles of each therapy is indicated .
some of these effects could be magnified by increasing the number of cycles of combination chemotherapy .
as the number of chemotherapy cycles was increased from one to three , there was an increase in the enrichment of clones with higher plasticity ( figure 5b ) .
additionally , we observed increased tumour sizes with longer simulations , as treatments typically failed to prevent the outgrowth of few faster - growing clones .
this was reflected in a dramatically increased variation in the number of surviving cancer cells across simulations .
we found that it was possible to enrich for any given phenotypic plasticity by altering the design of the combination chemotherapy .
for example , if seven treatments with an epithelial - specific agent were combined with one treatment with a mesenchymal - specific agent ( instead of the three : three design considered above ) , there was a further enrichment of more - mesenchymal clones ( figure 5c ) .
conversely , if seven treatments with a mesenchymal - specific agent were combined with one treatment with an epithelial - specific agent , the most strongly enriched clones were more - epithelial .
increasing the treatment imbalance only magnified this effect .
however , the most effective combination therapies were balanced in treatment , and selected for clones with roughly equal mixtures of epithelial and mesenchymal cell types ( figure 5c ) .
these observations indicated that plasticity was a clonal phenotype that could be selected for ( or against ) by sequentially applying selection pressures for specific phenotypic states .
we next simulated how combination therapies that sequentially applied epithelial - and mesenchymal - specific treatments compared with therapies that alternated these treatments , while leaving unchanged the total dose of each therapy applied .
although the total dose of therapy applied stayed the same , a combination therapy that alternated between the mesenchymal - and epithelial - specific treatments was far more effective ( 48 - fold ) at reducing tumour size relative to the sequentially applied combination , while simultaneously greatly reducing the selection for clones with increased phenotypic plasticity ( figure 5d ) .
moreover , we found that doubling the rate at which the therapies were alternated - - while halving their durations so as to maintain the same total dose of therapy applied - - further reduced tumour size ( figure 5d ) .
in contrast to the repeated sequential therapy design , repeating the alternating designs did not result in an increased tumour size , suggesting that it prevented the enrichment of resistant clones .
this observation demonstrates that the design of combination therapies has an enormous influence on their effectiveness , even in contexts where the total dose of therapy applied remains the same .
3. discussion in this study we used dna barcodes to assess phenotypic plasticity across hundreds of clones in a single population of cancer cells .
we found that the majority of cancer cell clones give rise to progeny in both the epithelial and mesenchymal states , and the ratio of epithelial and mesenchymal progeny differs between clones .
our results show that this ratio is stable within a clone , even over the course of weeks and through the rigors of single - cell cloning .
we speculate that the marked stability of phenotypic ratios across many generations could be determined by genetic factors , as has been previously proposed [ 36 ] .
differences in many such factors across clones would explain the log - normal distribution of phenotypic ratios we observed , if each factor had a small multiplicative effect on phenotypic ratio .
as we found that each phenotypic state is a mixture of mostly the same clones , despite the bias of clones towards one state or another , it is not surprising that others rarely saw genetic differences between populations sorted by phenotype [ 24 - 27 ] .
phenotypic switching can serve as a bet - hedging strategy allowing the survival of clones in diverse environments [ 37 ] .
phenotypic switching is prevalent across a variety of organisms , including prokaryotes [ 38,39 ] , yeasts [ 40,41 ] and cancer cells [ 42 ] .
in these examples , phenotype switching allows a clone to sample multiple phenotypes with different sensitivities and resistances , allowing the clone to survive in changing conditions .
since the epithelial and mesenchymal phenotypes we studied here are known to correlate strongly with sensitivity to most cancer therapies [ 43 - 45 ] , phenotypic switching between these states would serve as an effective bet - hedging strategy for cancer cells .
to be sure , cancer cells are not switching phenotypic states out of an awareness that this strategy will prove beneficial to them .
rather , as indicated by our simulations , cancer cell clones that undergo phenotypic switching have a competitive advantage and thus undergo a selective expansion when treated sequentially with therapies that selectively target the mesenchymal and epithelial states .
the diversity of phenotypic plasticities observed across clones allows fluctuating environments to select for a subset of clones with bet - hedging strategies optimally suited to a particular environment .
thus , stably inherited differences in phenotypic plasticity enable tumours to evolve optimal bet - hedging strategies .
phenotypic switching is a powerful mechanism for overcoming selection pressures that vary over time - - e.g. chemotherapy regimens - - and is consistent with observations of changing phenotypic proportions in progressing tumours [ 11 ] .
supporting this interpretation , the enrichment of a particular set of clones based on cell state due to drug - induced selection has been observed in vitro [ 28 ] .
resistant clones of the hcc827 non - small cell lung cancer cell line were observed to display a more - mesenchymal phenotype than the parental cell line , suggesting that a heritable difference in cell state resulted in their expansion during selection .
in principle , the differences in cell - state proportions we observed in a patient 's glioblastoma could arise in the absence of cellular plasticity if the clones identified by our analyses consisted of sub - clones with stable and distinct phenotypes .
however , we consider this unlikely since the existence of cellular plasticity in glioblastomas has been supported by several single - cell rna sequencing studies of patient tumours [ 18 ] .
while we used gene copy number differences to distinguish between the various clones , our analyses did not assess if these copy number distinctions played a functional role in determining clonal phenotypes .
the stable phenotypic plasticity of clones has implications for the design of combination treatments with phenotype - selective compounds .
as conventional chemotherapeutics can cause the enrichment of a mesenchymal , resistant population [ 10,43,46 ] , there have been significant efforts to develop therapies that target the resistant mesenchymal cells [ 47,48 ] .
once developed , implementation of an appropriate treatment regimen will be important for the therapeutic success of these compounds .
even comparing combination therapies with the same total doses , our simulations showed the order and schedule of doses have profound effects on the effectiveness of the therapy .
strikingly , the most simple combination therapy schedule ( one treatment , followed by the other ) was also the worst performing , while more - rapid , repeated alternations between treatments were far more effective at reducing tumour burden .
while changing selections enriched for more plastic clones , we found that even more - rapid alternation would reduce clonal enrichment .
these simulations suggest that , without due consideration of treatment schedule , the effectiveness of novel combination therapies could be undervalued .
additionally , our simulations underscore the importance of understanding heterogeneity and recommend alternations to be the most effective combination therapy .
4. material and methods 4.1 .
barcode library construction barcodes were synthesized as oligonucleotides from idt ( coralville , ia ) , and are listed in the electronic supplementary material , table s3 as clonalbarcode5 and clonalbarcode3 .
the oligonucleotides were annealed and ligated into pbabe puro ( addgene # 1764 , addgene , cambridge , ma ) that had been digested with bamhi - hf ( new england biolabs ) and ecori - hf ( new england biolabs ) , treated with calf intestinal phosphatase ( neb ) , and purified with a pcr purification kit ( qiagen ) .
one microlitre of 150 nm annealed clonal barcode was ligated to 190 ng of digested pbabe puro using t4 ligase ( new england biolabs ) overnight at 16degrees .
the ligation product was purified using 1x volume of ampurexp beads ( beckman coulter ) as per the manufacturer 's protocol , and eluted into 20 microl .
four times , 2 microl of purified ligation product was transformed into 40 microl of dh5alpha electromax escherichia coli ( fisher scientific ) .
transformed bacteria were allowed to recover in 1 ml soc medium , pooled and plated on lb agar with 100 microg ml - 1 ampicillin in two 245 mm plates ( corning , corning , ny ) .
some transformed mixture was diluted and plated for counting and colony estimation ; this yielded an estimate of approximately 1.7 x 106 colonies .
after overnight growth at 37degreesc , colonies were scraped off and plasmid dna was extracted with a gigaprep kit ( qiagen ) .
4.2 .
cell culture , virus preparation and infection mda - mb - 157 cells ( atcc , manassas , va ) and hek293t cells were cultured in dmem supplemented with 10 % fetal bovine serum , penicillin and streptomycin and glutamax ( thermo fisher scientific ) .
viral barcoding vectors were transfected into subconfluent hek293t cells with pcl - 10a1 retroviral packaging plasmid using fugene 6 ( promega , madison , wi ) and viral supernatant was collected and concentrated with polyethylene glycol ( peg ) .
for concentration , viral supernatant was spun at 931 gravities for 4 min and decanted into 1 / 5.5 volumes of sterile 50 % peg - 3350 in phosphate - buffered saline ( pbs ) .
after an overnight 4degrees incubation , the mixture was spun for 1455 gravities for 20 min , decanted , spun again at 524 gravities for 4 min , and the pellet resuspended in pbs with 1 % bovine serum albumin and frozen at - 80degreesc .
for infection , 1 x 104 cells were incubated with concentrated virus and 30 microg ml - 1 protamine sulphate and spun at 1455 gravities for 1.5 h. viral concentration was optimized to infect approximately 10 % of cells .
after 48 h , cells were selected with 3 microg ml - 1 puromycin to kill uninfected cells .
barcoded cells were expanded without discarding cells until the population was at least 2 x 107 cells , and subsequently split into subpopulations no smaller than 2 x 106 cells to maintain clonal representation .
4.3 .
amplification and sequencing of barcode plasmid pool barcodes were amplified using pcr from 2 ng of plasmid with 20 cycles of amplification , using clbc _ 5 _ primer _ aag and clbc _ 3 _ primer _ cct ( see electronic supplementary material , table s3 ) .
pcr products were run on a 2 % agarose gel , extracted using a gel extraction kit ( qiagen ) , and sequenced on a hiseq 2000 ( illumina ) , truseq - dna adaptors .
the sequencing primer used was clbc _ seq _ primer ( see electronic supplementary material , table s3 ) .
sequence data were analysed with a custom python script that first filtered by quality , where reads were only accepted if they contained fewer than 14 base pairs with a quality score < 25 , and had no base pairs with a quality score < 10 .
additionally , reads were only accepted if they contained the index sequences marking each library and the sequences common to every barcode , and every base in those sequences had a quality score of > 25 .
this resulted in 2.4 x 106 reads .
4.4 .
estimation of plasmid pool complexity pool complexity was estimated based on published methods of estimating the number of classes based on sample coverage [ 49 ] .
where n equals the estimated number of barcodes , n = the sample size ( 2 447 204 reads ) , d = the number of unique barcodes observed ( 1 530 822 ) , and f1 = the number of barcodes observed only once ( 989 844 ) , the sum of the probabilities of observed classes of barcodes was estimated as . this was used to estimate a lower bound on the number of unique barcodes in the plasmid pool , as . to estimate the accuracy of this estimation , random sequences of complexity n were randomly sampled ( with replacement ) n times , and the count of each unique sequence in the sample determined .
4.5 .
poisson modelling of viral infection viral infection of cells was modelled based on the multiplicity of infection and assuming that the number of infections per cell followed a poisson distribution , as has been observed by others [ 50,51 ] .
multiplicity of infection ( moi ) was estimated from the estimated number of cells infected ( 1.3 x 103 out of 1 x 104 ) ; where m = moi and p ( n ) = the proportion of cells infected with n viruses , the moi was estimated from [ 50 ] .
the moi was therefore estimated as 0.139 .
a poisson pdf was calculated from using this moi as the mu parameter , and was used to estimate the number of cells infected with different numbers of barcodes .
4.6 .
probability calculations of all cells uniquely barcoded , and simulations of barcodes in multiple cells the probability at least two cells share a barcode after infection , or p ( a ) , was calculated as 1 - p ( a ') , where p ( a ') is the probability that all cells have unique barcodes .
this calculation is analogous to the so - called ' birthday problem ' [ 52 ] .
where n = the estimated number of barcodes ( from sequencing the barcode plasmid pool , 2 570 562 ) and c = the number of cells infected ( 1372 ) , to estimate the probability of different numbers of cells sharing barcodes with other cells , c barcodes were randomly sampled from n barcodes , 5 x 105 times with replacement .
4.7 .
intracellular flow cytometry cells were trypsinized , washed in dmem supplemented with 10 % fetal bovine serum ( sigma - aldrich , st. louis , mo ) , washed 2x in pbs , and spun ( as with all subsequent washes ) at 524 gravities for 3 min .
the pellet was disrupted by vortexing and the cells fixed by dripping in 2 ml of ice - cold 70 % ethanol while vortexing .
vortexing was continued for 30 s and the cells incubated overnight at 4degreesc .
cells were blocked by washing 3x in facs buffer ( fb ) , consisting of pbs supplemented with 6 % fetal bovine serum ( sigma - aldrich ) .
cells were filtered through a 40 microm filter , counted on a haemocytometer , resuspended to 1 x 106 cells ml - 1 in fb and stained with a 1 : 50 dilution of mouse anti k8 / 18 , clone c51 ( cell signaling , danvers , ma ) , for 1 - 2 h on ice .
after washing 3x with fb , cells were stained in fb at a concentration of 1 x 106 cells ml - 1 and a 1 : 1000 dilution of goat anti mouse fab alexa fluor 488 ( cell signaling ) , incubating for 0.5 to 1 h on ice in the dark .
cells were washed 3x in fb and resuspended at 1 x 106 cells ml - 1 in fb. samples were run on a fortessa ( becton dickinson , franklin lakes , nj ) , and flow cytometry data were analysed with flowjo ( tree star , ashland , or ) .
4.8 .
fluorescence - activated cell sorting for single - cell cloning , clonally barcoded mda - mb - 157 cells were trypsinized , washed with pbs supplemented with 3 % fbs , sent through a 40 microm filter , and resuspended to 1 x 106 cells ml - 1 .
a facsaria ( becton dickinson ) was used to sort single cells into wells of 96 - well plates , each well containing 100 microl of dmem with 10 % fbs .
after expansion of the barcoded population of cells , a portion of the cells were stained for keratin 8 / 18 expression and sorted via facs .
portions were separated out of the population and sorted at three time points each separated by a week ( day 0 , day 7 , day 14 ) .
for these sorts based on keratin 8 / 18 expression , cells were stained as in intracellular flow cytometry , but stained at 1 x 107 cells ml - 1 in fb and with a 1 : 60 dilution of mouse anti k8 / 18 , clone c51 ( cell signaling ) , for 1 - 2 h on ice .
after secondary staining and washes , cells were resuspended at 1 x 107 cells ml - 1 in fb and sorted on a facsaria ( becton dickinson ) set to maximize yield .
sorted samples were analysed on the facsaria to measure the proportion of cells mis - segregated , counted on a haemocytometer , and split in half .
barcodes were extracted from these cells as described below .
4.9 .
extraction and amplification of barcodes from genomic dna genomic dna was collected with a dneasy kit ( qiagen , venlo , the netherlands ) .
all genomic dna was digested with bamhi and ecori ( new england biolabs , ipswich , ma ) , using 3 units microg - 1 and digesting for 1 h at 37degrees .
digested dna was directly purified from solution with a gel extraction kit ( qiagen ) , and barcodes size - selected with agencourt ampure xp beads ( beckman coulter , brea , ca ) .
for size selection , one - half volume of beads was added to the dna mixture to bind to large dna fragments , mixed by vortexing , and incubated at room temperature for 5 min .
after precipitating the beads with a magnet , the supernatant containing small dna was removed , and dna was purified from the supernatant with a gel extraction kit ( qiagen ) and quantified on a nanodrop ( thermo scientific ) .
barcodes were amplified from purified size - selected dna using 25 cycles of pcr with extaq ( takara bio , kyoto , japan ) , assembling the reaction mixture on ice .
template was added to a final concentration of 10 ng microl - 1 , and all size - selected dna was used as template .
this pcr step was used to also add library - specific index sequences ( to allow for sequencing multiple samples in the same sequencing lane ) and adaptor sequences for high - throughput sequencing .
index sequences were designed to have at least two differences from all other index sequences .
primer sequences are listed in the electronic supplementary material , table s3 .
pcr products were purified with a pcr purification kit ( qiagen ) .
samples of 4 , 2 and 1 microl of each pcr product were run on a 2 % agarose gel and the intensity of the 131 base pair band quantified electronically .
samples' relative dna concentration was computed with linear regression and the samples were combined in equimolar ratios .
this combined library was run on a 2 % agarose gel , and the 131 base pair band was purified with a gel extraction kit ( qiagen ) .
the purified band was sequenced on a hiseq2000 ( illumina , san diego , ca ) ; the resulting sequencing data are available at the ncbi sra ( srx1175944 ) .
4.10 .
analysis of sequencing data ( sorted cells ) sequencing data were analysed with custom python scripts .
reads were first filtered by quality , where reads were only accepted if they contained fewer than 6 base pairs with a quality score < 25 , and had no base pairs with a quality score < 15 .
additionally , reads were only accepted if they contained the index sequences marking each library and the sequences common to every barcode .
these steps reduced 1.67 x 108 reads to 1.01 x 108 reads .
this quality filtering procedure was more stringent than that used to analyse barcodes from the plasmid pool due to the increased cycles of amplification involved in library construction and lower starting pool complexity , which resulted in lower quality reads .
reads were then separated based on library - specific sequences that were introduced during pcr to distinguish samples .
taking reads for barcodes seen at least twice , we , as others , combined reads that could be connected with few mismatches , using the most abundant barcode to represent the group and giving it the abundance of the sum of the group 's reads [ 29,53 ] .
to avoid erroneously combining barcodes that were by chance similar in sequence , we repeatedly iterated down the list of barcodes ordered by abundance , grouping together less abundant barcodes that were within one mismatch , and then repeating the process grouping together less abundant barcodes within two , three and four mismatches .
we then removed from analysis any barcodes that were not detected in any libraries from one or more time points .
these data were used to test for clones' bi - lineage potential and cell - state bias , below , to allow for statistical analysis of clones based on the actual number of reads .
for further analysis , reads for each library were normalized by dividing by the sum of reads for that library multiplied by the fraction of the population consisting of that cell state at the time of sorting , being 60 % for k8 / 18 high and 40 % for k8 / 18 low .
any barcodes not found in a library were given a fractional value of 1 x 10 - 6 for that library .
to deal with sort contamination , for each barcode , and for each time point , we subtracted from each sorted library the average fraction of total reads of the other sorted populations multiplied by the fractional contamination observed in that sort from post - sort flow cytometry .
any barcode abundance thus brought to less than zero was given a value of 1 x 10 - 6 .
after determining in this way the size of each clone in each state , the results from the two sequenced replicates from each time point ( see above ) were combined by taking their mean .
4.11 .
testing for clones' bi - lineage potential to determine whether clones did in fact have bi - lineage potential , we asked whether , for each clone , we could reject the hypothesis that there were as many reads as could be expected via sort contamination ( mis - sorted cells ) , assuming each clone was composed entirely of cells in one state .
the proportion of mis - sorted cells was determined via flow cytometry of the sorted cells ( see above ) , here represented as sigmam,t for the proportion of mesenchymal - sorted cells at time t that were actually mis - sorted epithelial cells , and similarly sigmae,t. after sorting at three time points ( days 0 , 7 and 14 ; see above ) , each pool of sorted cells was split into two , and sequenced ( see above ) .
at each time point , the reads for each clone in each state were summed , creating re ( c , t ) for the summed epithelial ( keratin 8 / 18 +) reads of clone c at time point t , and similarly rm ( c , t ) .
as the count of observed reads for each clone was being compared with reads expected from sort contamination , the un - normalized reads from clones were used ( see above ) .
in order to test for bi - lineage potential , we calculated for each state , at each time point , the expected probability of a read in the other state from sort contamination , assuming all cells were in the first state , or pce ( t ) for the probability of epithelial reads being mis - called as mesenchymal , assuming all cells were epithelial , and pcm ( t ) for the probability of mesenchymal reads being mis - called as epithelial , assuming all cells were mesenchymal .
for ease of understanding the calculation of these probabilities , the reads from the epithelial - sorted population can be visualized as a combination of reads from real epithelial cells ( totalling ( 1 - sigmae ) times the sum of epithelial - sorted reads ) and reads from real mesenchymal cells ( totalling sigmae times the sum of epithelial - sorted reads ) .
similarly , the reads from the mesenchymal - sorted population can be viewed as a combination of reads from real mesenchymal cells ( totalling ( 1 - sigmam ) times the sum of mesenchymal - sorted reads ) and reads from real epithelial cells ( totalling sigmam times the sum of mesenchymal - sorted reads ) .
therefore , the sum of reads from correctly sorted epithelial cells ( e ) at time t is the sum of reads from incorrectly sorted epithelial cells ( e ') at time t therefore is the sum of reads from correctly - and incorrectly - sorted mesenchymal cells was calculated similarly .
pce is defined as the proportion of all epithelial reads that were mis - called as mesenchymal , which is equal to e '/( e + e ') .
therefore , these probabilities were calculated asand for each time point , and each clone , these probabilities were used to test the hypothesis that each clone was actually monolineage .
to test the null hypothesis that all clones were epithelial , each clone was evaluated at 1 - the cdf of a binomial distribution with p = pce and for clone c , evaluated at x = rm ( c,t ) .
similarly , to test the null hypothesis that all clones were mesenchymal , each clone was evaluated at 1 - the cdf of a binomial distribution with p = pcm and for clone c , evaluated at x = re ( c,t ) .
these resulting p values from all states and all time points were corrected for multiple hypothesis testing using the benjamini - hochberg method [ 54 ] .
the null hypothesis that a clone was monolineage at a particular time point was rejected to control the false discovery rate ( fdr ) at 0.05 .
a clone was declared monolineage if the null hypothesis was rejected at all time points for the same state , and at no time points for the other state .
a clone was declared bi - lineage if the null hypothesis was rejected in both states ( still at the fdr of 0.05 ) in at least one time point .
4.12 .
testing for clones' cell - state bias to test whether clones had bias in cell state , we attempted to reject the null hypothesis that each clone 's cell - state proportions matched the population cell - state proportion .
again , pre - normalized reads ( see above ) were used .
reads from the two sequenced replicates of each sorted population were summed .
for each clone , at each time point , the expected number of reads in the epithelial and mesenchymal states were calculated , or ee ( c,t ) and em ( c,t ) , respectively : the chi2 test was used to examine the significance of the fit between the observed and expected reads .
the upper cdf of the chi2 distribution with one degree of freedom was evaluated at x , where : these resulting p values from all time points were corrected for multiple hypothesis testing using the benjamini - hochberg method [ 54 ] .
the null hypothesis that a clone at a time point had a cell - state bias matching the population cell - state proportions was rejected so as to control the false discovery rate at 0.05 .
clones were declared significantly different from the population cell - state proportion if this null hypothesis was rejected at all time points .
4.13 .
fraction epithelial and log2 ( epithelial / mesenchymal ) ratio calculations after normalizing the sequencing data of sorted cells ( see above ) to determine the size of each clone in the epithelial and mesenchymal states , and after subtracting those reads estimated to come from sort contamination , each clone 's cell - state bias was determined , represented by the fraction of the clone that was epithelial ( fraction epithelial ) or the log2 ( epithelial / mesenchymal ) ratio ( log2 ( e / m )) .
here , ec,t equals the normalized fraction of cells of clone c in the epithelial state at time point t , and similarly mc,t. these estimated cell counts are normalized such that the sum of epithelial and mesenchymal counts across clones at each time point equals one .
for both of these calculations , dividing e by m or ( e + m ) cancels out this normalization factor , rendering the calculations equivalent to those using counts of cells .
the fraction of clone c epithelial at time point t was calculated asthe log2 ( e / m ) ratio for clone c at time point t was calculated asthe log2 ( e / m ) ratio for clone c averaging across the three time points was calculated as 4.14 .
testing the significance of the correlation of clones' cell - state bias across time points the pearson correlation of clones' log2 ( e / m ) ratio across time points was determined to assess the stability of cell - state bias .
to determine the probability of randomly obtaining a correlation higher than the one observed in each of the three comparisons across time points , the barcode labels of one time point in each comparison were randomly shuffled .
after each randomization , the pearson correlation was evaluated and the correlation coefficient rho recorded .
after 1 x 106 such randomizations , the distribution of randomized rho values was compared with the observed rho , and the proportion of randomized rho greater than observed rho determined .
4.15 .
clone growth rate calculations from the frequency of splitting during cell culture , the population of cells was estimated to double approximately three times per week .
the population of cells sorted at the first time point consisted of 2.9 x 107 cells , and this population growth rate was used to estimate the number of cells at 1 and 2 weeks later , at the second and third time points .
as the barcode sequencing information was used to calculate relative size of each clone as a fraction of the total population , these population cell numbers were used to compute the cell numbers of each clone at each time point through multiplication .
each clone 's number of cells at the second and third time points ( ni,c ) were compared with cell numbers from the first time point ( n0,c ) to compute each clone 's growth rate over these two intervals ; the two rates were averaged to compute each clone 's growth rate ( kc ) : 4.16 .
calculation of shannon entropy of the distribution of clones' epithelial / mesenchymal ratio after calculating the geometric - average log2 ( epithelial / mesenchymal ) for each clone across the three examined time points , clones were binned from the minimum ratio to the maximum ratio in bins of width 1 ( corresponding to a two - fold change in ratio ) .
the shannon entropy of clones thus binned was calculated .
4.17 .
flow cytometry of single - cell clones single - cell clones were trypsinized , washed in dmem supplemented with 10 % fetal bovine serum ( sigma - aldrich ) , and washed 2x in pbs .
cells were fixed as in intracellular flow cytometry .
to serve as an internal staining control for the single - cell clones , pooled clones ( the parental barcoded population ) were fixed in the same way as the single - cell clones .
this pooled clone population was resuspended at 1 x 106 cells ml - 1 in pbs and covalently stained with 1 microl ml - 1 of blue live / dead discrimination dye ( thermo fisher scientific , cambridge , ma ) for 30 min on ice in the dark .
cells were blocked by washing 3x in facs buffer , filtered through a 40 microm filter , counted on a haemocytometer , and resuspended to 1 x 106 cells ml - 1 in fb. for analysis of single - cell clones , clones were mixed 1 : 1 with samples from the covalently stained pooled clones .
samples were then stained as in the intracellular flow cytometry protocol and run on a fortessa ( becton dickinson ) , and the flow cytometry data analysed with flowjo .
after using flowjo gating to remove debris , the flow cytometry data were exported and analysed with a custom python script .
in brief , this script separated the cells of the pooled clones , and determined thresholds of k8 / 18 staining to gate e and m from this population such that the gates contained the same proportion of cells as the gates used for cell sorting .
these gates were then used to determine the proportion of cells from the single - cell clone that would have been sorted as epithelial or mesenchymal to calculate the log2 ( epithelial / mesenchymal ) .
4.18 .
pcr and sanger sequencing of barcodes from single - cell clones genomic dna was collected with a dneasy blood and tissue kit ( qiagen ) as per the manufacturer 's instructions .
barcodes were amplified with nested pcr , using two sets of primers ( idt , coralville , ia ) ( first clbc _ a5 and clbc _ a3 , then clbc _ b5 and clbc _ b3 ; see electronic supplementary material , table s3 ) to specifically amplify one band .
the initial genomic dna concentration was 1.2 ng microl - 1 , and each round of pcr was 25 cycles .
the pcr product was purified with a pcr purification kit ( qiagen ) and sequenced with sanger sequencing ( genewiz , south plainfield , nj ) .
4.19 .
analysis of correlation of single - cell clone / pool phenotypic ratio narrow - sense heritability was calculated as the pearson correlation coefficient [ 55 ] .
twenty - eight clones were deemed sufficient as power analysis showed a power of 0.96 to reject the null hypothesis at a significance of 0.01 for correlations of 0.7 , calculated using the pwr package in r. to determine the probability of randomly obtaining a correlation higher than the one observed between single - cell clones' phenotypic proportion and those clones' phenotypic proportion in the pooled experiment , the barcode labels of single - cell clones were randomly shuffled between the single - cell clones using a custom script .
after each randomization the pearson correlation was evaluated and the correlation coefficient rho recorded .
after 1 x 106 such randomizations , we compared the distribution of randomized rho values with the observed rho .
4.20 .
glioblastoma single - cell rna sequencing data normalized single - cell rna sequencing data from primary glioblastoma tumours were obtained from the gene expression omnibus ( accession gse57872 ) [ 18 ] .
4.21 .
copy - number estimation from single - cell rna sequencing data and clone separation as has been previously described [ 18,34 ] , changes in copy number were estimated through analysis of single - cell rna expression by chromosomal location .
mean normalized ( by gene across cells ) log2 ( tpm + 1 ) rna values from single cells were accessed from gse57872 [ 18,56 ] .
rna data were from cells that were identified either as non - cancer cells or as cells from tumour mgh31 .
for the purposes of determining copy - number variation , these data were thresholded , so that values greater than were set to 3 , and values less than - 3 were set to - 3 .
for each cell , we computed a sliding average of the expression of 101 genes moving down the list of genes with rna data ordered by chromosomal location , to build a copy - number variation profile ( cnv profile ) .
we then centred each cell 's cnv profile at 0 ( subtracting from each profile the mean value ) to deal with any differences in expression remaining across cells .
this meant that the cnv profile value for cell j at position i ( cnvi,j ) iswhere to normalize to the average expression by chromosomal location , so as to deal with differences in expression across chromosomes , each cell 's cnv profile was normalized using an averaged cnv profile from normal cells ( cnvbase ) , computed for each genomic location through an identical sliding - average strategy from normal neural cells identified in the same rna - seq dataset [ 18 ] .
for each cell , this normalized cnv ( cnvnorm ) was calculated as follows : in this way , cnv values were only recorded if they deviated significantly from the value obtained from normal cells , where a difference of 0.3 corresponds to a 23 % change .
the cells' normalized cnv profiles were clustered via ward 's method , using the euclidean distances between cnv profiles .
this method clusters vectors by finding , at each step , the pair of clusters that leads to the minimum increase in within - cluster variability when the clusters are combined .
in this way , the hierarchical clustering of cnv profiles clustered cells based on similar cnv profiles ; cells were divided into clones based on this hierarchical clustering .
4.22 .
subtype and stemness classification from single - cell rna sequencing data cells were classified by subtype as previously described [ 18 ] .
cells were scored by subtype using published lists of genes enriched in each subtype [ 35 ] , or marking cells with increased stemness [ 18 ] .
mean normalized ( by gene , across cells ) log2 ( tpm + 1 ) rna values for single cells were accessed from gse57872 [ 18,56 ] .
for each cell , a score was calculated for each subtype .
these scores for cell i for subtype j ( si,j ) were calculated by taking the average expression of classifier genes for subtype j ( gc ) in cell i , and subtracting the mean expression of every gene in cell i : to evaluate each individual score for significance , we adapted a previously published method [ 18 ] , evaluating the enrichment of each score relative to random sets .
for each subtype , we made 100 random subtype - classifier gene sets from randomly sampling the set of sequenced genes .
each random set had the same number of genes as the real subtype gene set .
we called each cell 's subtype score as enriched or depleted by comparing it to these random scores .
if the real score was greater than 95 % of the random scores , we called it enriched , whereas if the real score was less than 95 % of the random scores , we called it depleted .
to determine whether clones had different distributions of subtype scores , suggesting differences in plasticity , we evaluated the distributions of subtype scores across cells grouped into clones by the clustering above with a kruskal - wallis test .
4.23 .
simulations mechanistically , a ' tumour ' was seeded with 500 clones .
each clone was assigned a fraction epithelial , growth rate and cell numbers matching a randomly chosen observed clone , so as to simulate the distribution of the observed growth rates and fraction epithelial .
both the growth rate and fraction epithelial parameters were inherent to the clone for the entirety of the simulation .
each clone 's starting cell numbers were drawn from those observed at day 0 of sorting ( see above ) .
after instantiation of the tumour , growth was modelled under different treatment regimes , with 15 time points modelling a day .
the amount of cells for each clone after division were calculated as : , where ns,i ( t ) represents the number of cells of clone i in state s at time t , di represents the doubling time ( in the time scale of the simulation , where 15 time points is equivalent to 1 day ) of clone i. at each time point , cells were also allowed to differentiate .
each clone 's transition probabilities for going from epithelial to mesenchymal or mesenchymal to epithelial were defined so that 20 % of cells changed state per division , and the ratio of transition probabilities matched the clone 's defined equilibrium of cell states ; in this way , the clones have stable cell - state proportions at equilibrium and slowly return to equilibrium after the cell - state ratios are perturbed through selection .
this probability of differentiation was chosen to reflect those observed in other contexts [ 12 ] .
the resulting number of cells of clone i in state s ( where the other state is s ') , or , as a consequence of differentiation is as follows : here , ps,i represents the probability that a cell of clone i differentiates from state s to state s ' .
this was calculated as follows , where ri represents the equilibrium epithelial : mesenchymal ratio of clone i : and ; psi here represents the probability of a cell differentiating during a division , or 0.2 as discussed above .
if no treatment is simulated during this time point , is now the final count of cells for clone i in state s for time point t , or ns,i ( t ) .
treatments were applied as mesenchymal - specific or epithelial - specific , where a mesenchymal targeting therapy killed a 10 - fold higher fraction of the mesenchymal cells compared to epithelial cells .
this was chosen to match the relative effectiveness of certain in vitro compounds on cells in different differentiation states [ 57 ] .
the number of cells remaining after death () for a treatment targeting state s is calculated as , and for a treatment targeting state s' ( the other state ) , , where . in this case is now the final count of cells for clone i in state s for time point t , or ns,i ( t ) .
each treatment cycle killed a fraction of the cells for 30 time points , simulating a course of therapy for 2 days , which was followed with 20 time points of no treatment .
the simulation was ended after the conclusion of treatment - rest periods ; the number and pattern of treatment - rest periods varied among the simulations .
a variety of treatment combinations were simulated as detailed in the results .
to compare the results of different simulations , clones were binned by their fraction epithelial .
each clone 's fold change in cell numbers during the simulation ( fci for clone i ) was computed aswhere ns,i ( t ) represents the number of cells of clone i in state s at time t , t0 is the time point of the start of simulated treatments , and tend the time point of the end of simulated treatments .
for each bin of clones by fraction epithelial , the median fold change in cell numbers for the clones in each bin was computed .
the sum of cells across clones at the last point was also computed for each simulated treatment .
simulations were repeated 500 times , and the 0.1 , 0.5 and 0.9 quantiles of the median clone fold change for each bin across simulations were recorded .
similarly , the 0.1 , 0.5 and 0.9 quantiles of the sum of cell numbers across simulations were recorded .
supplementary material supplementary table 1 : phenotypic ratios and estimated population sizes of barcoded clones supplementary material supplementary figures and supplementary tables 2 - 3 supplementary material reads for each clone supplementary material normalized reads for each clone supplementary material empirical data for simulations supplementary material markers for glioblastoma subtypes and stem - ness acknowledgements we acknowledge the whitehead institute flow cytometry facility for assistance with flow cytometry and cell sorting , and the mit biomicro center and whitehead institute genome technology core for assistance with high - throughput sequencing .
data accessibility phenotypic ratios and estimated population sizes of barcoded clones can be found in the electronic supplementary material , table s1 .
the phenotypic ratios of single - cell clones can be found in the electronic supplementary material , table s2 .
primers and oligonucleotide sequences used are in the electronic supplementary material , table s3 .
the number of observed reads for each clone is in electronic supplementary material , clonereads.txt .
normalized reads for each clone ( see material and methods ) are in the electronic supplementary material , norm _ filtered _ read.csv .
analysed data used for clone simulations are available in the electronic supplementary material , observeddata.csv .
markers for determining glioblastoma subtypes [ 18,35 ] are in the electronic supplementary material , markerssubtype.txt .
sequencing reads of sorted cell barcodes from this manuscript are in the ncbi short read archive , accession srx1175944 .
single - cell rna sequencing data were obtained from the ncbi gene expression omnibus at gse57872 [ 18 ] .
codes associated with this project can be found at https :// github.com / rmathiswi / clonecodes .
authors' contributions r.a.m. performed the experiments and statistical analysis .
r.a.m. and p.b.g. designed the experiments .
e.s.s. and r.a.m. wrote the simulations .
p.b.g. , r.a.m. and e.s.s. wrote the manuscript .
competing interests we have no competing interests .
funding this work was funded by the national science foundation graduate research fellowship program ( 1122374 ; e.s.s. ) , the richard and susan smith family foundation , the breast cancer alliance and the national institutes of health ( 2t32gm007287 - 36 , r.a.m. ) .
references 1 heppner gh 1984 tumor heterogeneity . cancer res .
44 , 2259 - 2265 . 6372991 2 meacham ce , morrison sj 2013 tumour heterogeneity and cancer cell plasticity . nature 501 , 328 - 337 . ( doi : 10.1038 / nature12624 ) 24048065 3 nowell pc 1976 the clonal evolution of tumor cell populations . science 194 , 23 - 28 . ( doi : 10.1126 / science.959840 ) 959840 4 gerlinger m et al .
2012 intratumor heterogeneity and branched evolution revealed by multiregion sequencing . n. engl. j. med. 366 , 883 - 892 . ( doi : 10.1056 / nejmoa1113205 ) 22397650 5 shah sp et al .
2012 the clonal and mutational evolution spectrum of primary triple - negative breast cancers . nature 486 , 395 - 399 . ( doi : 10.1038 / nature10933 ) 22495314 6 yates lr et al .
2015 subclonal diversification of primary breast cancer revealed by multiregion sequencing . nat. med. 21 , 751 - 759 . ( doi : 10.1038 / nm.3886 ) 26099045 7 wang y et al .
2014 clonal evolution in breast cancer revealed by single nucleus genome sequencing . nature 512 , 155 - 160 . ( doi : 10.1038 / nature13600 ) 25079324 8 navin n et al .
2011 tumour evolution inferred by single - cell sequencing . nature 472 , 90 - 94 . ( doi : 10.1038 / nature09807 ) 21399628 9 eirew p et al .
2015 dynamics of genomic clones in breast cancer patient xenografts at single - cell resolution . nature 518 , 422 - 426 . ( doi : 10.1038 / nature13952 ) 25470049 10 fillmore cm , kuperwasser c 2008 human breast cancer cell lines contain stem - like cells that self - renew , give rise to phenotypically diverse progeny and survive chemotherapy . breast cancer res .
10 , r25 ( doi : 10.1186 / bcr1982 ) 18366788 11 park sy , lee he , li h , shipitsin m , gelman r , polyak k 2010 heterogeneity for stem cell - related markers according to tumor subtype and histologic stage in breast cancer . clin .
cancer res .
16 , 876 - 887 . ( doi : 10.1158 / 1078 - 0432.ccr - 09 - 1532 ) 20103682 12 gupta pb , fillmore cm , jiang g , shapira sd , tao k , kuperwasser c , lander es 2011 stochastic state transitions give rise to phenotypic equilibrium in populations of cancer cells . cell 146 , 633 - 644 . ( doi : 10.1016 / j.cell.2011.07.026 ) 21854987 13 chaffer cl et al .
2011 normal and neoplastic nonstem cells can spontaneously convert to a stem - like state . proc natl. acad. sci. usa 108 , 7950 - 7955 . ( doi : 10.1073 / pnas.1102454108 ) 21498687 14 chaffer cl , marjanovic nd , lee t , bell g , kleer cg , reinhardt f , d'alessio ac , young ra , weinberg ra 2013 poised chromatin at the zeb1 promoter enables breast cancer cell plasticity and enhances tumorigenicity . cell 154 , 61 - 74 . ( doi : 10.1016 / j.cell.2013.06.005 ) 23827675 15 chang hh , hemberg m , barahona m , ingber de , huang s 2008 transcriptome - wide noise controls lineage choice in mammalian progenitor cells . nature 453 , 544 - 547 . ( doi : 10.1038 / nature06965 ) 18497826 16 roesch a et al .
2010 a temporarily distinct subpopulation of slow - cycling melanoma cells is required for continuous tumor growth . cell 141 , 583 - 594 . ( doi : 10.1016 / j.cell.2010.04.020 ) 20478252 17 yang g et al .
2012 dynamic equilibrium between cancer stem cells and non - stem cancer cells in human sw620 and mcf - 7 cancer cell populations . br. j. cancer 106 , 1512 - 1519 . ( doi : 10.1038 / bjc.2012.126 ) 22472879 18 patel ap et al .
2014 single - cell rna - seq highlights intratumoral heterogeneity in primary glioblastoma . science 344 , 1396 - 1401 . ( doi : 10.1126 / science.1254257 ) 24925914 19 phillips s et al .
2014 cell - state transitions regulated by slug are critical for tissue regeneration and tumor initiation . stem cell reports 2 , 633 - 647 . ( doi : 10.1016 / j.stemcr.2014.03.008 ) 24936451 20 schwitalla s et al .
2013 intestinal tumorigenesis initiated by dedifferentiation and acquisition of stem - cell - like properties . cell 152 , 25 - 38 . ( doi : 10.1016 / j.cell.2012.12.012 ) 23273993 21 polyak k , weinberg ra 2009 transitions between epithelial and mesenchymal states : acquisition of malignant and stem cell traits . nat. rev .
cancer 9 , 265 - 273 . ( doi : 10.1038 / nrc2620 ) 19262571 22 marjanovic nd , weinberg ra , chaffer cl 2013 cell plasticity and heterogeneity in cancer . clin. chem .
59 , 168 - 179 . ( doi : 10.1373 / clinchem.2012.184655 ) 23220226 23 mani sa et al .
2008 the epithelial - mesenchymal transition generates cells with properties of stem cells . cell 133 , 704 - 715 . ( doi : 10.1016 / j.cell.2008.03.027 ) 18485877 24 klevebring d , rosin g , ma r , lindberg j , czene k , kere j , fredriksson i , bergh j , hartman j 2014 sequencing of breast cancer stem cell populations indicates a dynamic conversion between differentiation states in vivo . breast cancer res .
16 , r72 ( doi : 10.1186 / bcr3687 ) 24998755 25 shipitsin m et al .
2007 molecular definition of breast tumor heterogeneity . cancer cell 11 , 259 - 273 . ( doi : 10.1016 / j.ccr.2007.01.013 ) 17349583 26 balic m , schwarzenbacher d , stanzer s , heitzer e , auer m , geigl jb , cote rj , datar rh , dandachi n 2013 genetic and epigenetic analysis of putative breast cancer stem cell models . bmc cancer 13 , 358 ( doi : 10.1186 / 1471 - 2407 - 13 - 358 ) 23883436 27 park sy , gonen m , kim hj , michor f , polyak k 2010 cellular and genetic diversity in the progression of in situ human breast carcinomas to an invasive phenotype . j. clin. invest .
120 , 636 - 644 . ( doi : 10.1172 / jci40724 ) 20101094 28 bhang he et al .
2015 studying clonal dynamics in response to cancer therapy using high - complexity barcoding . nat. med. 21 , 440 - 448 . ( doi : 10.1038 / nm.3841 ) 25849130 29 nguyen lv et al .
2014 dna barcoding reveals diverse growth kinetics of human breast tumour subclones in serially passaged xenografts . nat. commun .
5 , 5871 ( doi : 10.1038 / ncomms6871 ) 25532760 30 wagenblast e et al .
2015 a model of breast cancer heterogeneity reveals vascular mimicry as a driver of metastasis . nature 520 , 358 - 362 . ( doi : 10.1038 / nature14403 ) 25855289 31 cheung am , nguyen lv , carles a , beer p , miller ph , knapp dj , dhillon k , hirst m , eaves cj 2013 analysis of the clonal growth and differentiation dynamics of primitive barcoded human cord blood cells in nsg mice . blood 122 , 3129 - 3137 . ( doi : 10.1182 / blood - 2013 - 06 - 508432 ) 24030380 32 lu r , neff nf , quake sr , weissman il 2011 tracking single hematopoietic stem cells in vivo using high - throughput sequencing in conjunction with viral genetic barcoding . nat. biotechnol .
29 , 928 - 933 . ( doi : 10.1038 / nbt.1977 ) 21964413 33 taylor - papadimitriou j , stampfer m , bartek j , lewis a , boshell m , lane eb , leigh im 1989 keratin expression in human mammary epithelial cells cultured from normal and malignant tissue : relation to in vivo phenotypes and influence of medium . j. cell sci. 94 , 403 - 413 . 2483723 34 tirosh i et al .
2016 single - cell rna - seq supports a developmental hierarchy in human oligodendroglioma . nature 539 , 309 - 313 . ( doi : 10.1038 / nature20123 ) 27806376 35 verhaak rg et al .
2010 integrated genomic analysis identifies clinically relevant subtypes of glioblastoma characterized by abnormalities in pdgfra , idh1 , egfr , and nf1 . cancer cell 17 , 98 - 110 . ( doi : 10.1016 / j.ccr.2009.12.020 ) 20129251 36 huang s 2013 genetic and non - genetic instability in tumor progression : link between the fitness landscape and the epigenetic landscape of cancer cells . cancer metastasis rev .
32 , 423 - 448 . ( doi : 10.1007 / s10555 - 013 - 9435 - 7 ) 23640024 37 kussell e , leibler s 2005 phenotypic diversity , population growth , and information in fluctuating environments . science 309 , 2075 - 2078 . ( doi : 10.1126 / science.1114383 ) 16123265 38 beaumont hj , gallie j , kost c , ferguson gc , rainey pb 2009 experimental evolution of bet hedging . nature 462 , 90 - 93 . ( doi : 10.1038 / nature08504 ) 19890329 39 kussell e , kishony r , balaban nq , leibler s 2005 bacterial persistence : a model of survival in changing environments . genetics 169 , 1807 - 1814 . ( doi : 10.1534 / genetics.104.035352 ) 15687275 40 acar m , mettetal jt , van oudenaarden a 2008 stochastic switching as a survival strategy in fluctuating environments . nat. genet .
40 , 471 - 475 . ( doi : 10.1038 / ng.110 ) 18362885 41 newby ga , lindquist s 2013 blessings in disguise : biological benefits of prion - like mechanisms . trends cell biol .
23 , 251 - 259 . ( doi : 10.1016 / j.tcb.2013.01.007 ) 23485338 42 sharma sv et al .
2010 a chromatin - mediated reversible drug - tolerant state in cancer cell subpopulations . cell 141 , 69 - 80 . ( doi : 10.1016 / j.cell.2010.02.027 ) 20371346 43 singh a , settleman j 2010 emt , cancer stem cells and drug resistance : an emerging axis of evil in the war on cancer . oncogene 29 , 4741 - 4751 . ( doi : 10.1038 / onc.2010.215 ) 20531305 44 feng yx et al .
2014 epithelial - to - mesenchymal transition activates perk - eif2alpha and sensitizes cells to endoplasmic reticulum stress . cancer discov .
4 , 702 - 715 . ( doi : 10.1158 / 2159 - 8290.cd - 13 - 0945 ) 24705811 45 tiwari n , gheldof a , tatari m , christofori g 2012 emt as the ultimate survival mechanism of cancer cells . semin .
cancer biol .
22 , 194 - 207 . ( doi : 10.1016 / j.semcancer.2012.02.013 ) 22406545 46 li x et al .
2008 intrinsic resistance of tumorigenic breast cancer cells to chemotherapy . j. natl .
cancer inst .
100 , 672 - 679 . ( doi : 10.1093 / jnci / djn123 ) 18445819 47 visvader je , lindeman gj 2012 cancer stem cells : current status and evolving complexities . cell stem cell .
10 , 717 - 728 . ( doi : 10.1016 / j.stem.2012.05.007 ) 22704512 48 gupta pb , onder tt , jiang g , tao k , kuperwasser c , weinberg ra , lander es 2009 identification of selective inhibitors of cancer stem cells by high - throughput screening . cell 138 , 645 - 659 . ( doi : 10.1016 / j.cell.2009.06.034 ) 19682730 49 anne chao s - ml 1992 estimating the number of classes via sample coverage . j. am. stat. assoc .
87 , 210 - 217 . ( doi : 10.1080 / 01621459.1992.10475194 ) 50 arai t , takada m , ui m , iba h 1999 dose - dependent transduction of vesicular stomatitis virus g protein - pseudotyped retrovirus vector into human solid tumor cell lines and murine fibroblasts . virology 260 , 109 - 115 . ( doi : 10.1006 / viro.1999.9773 ) 10405362 51 ellis el , delbruck m 1939 the growth of bacteriophage . j. gen. physiol .
22 , 365 - 384 . ( doi : 10.1085 / jgp.22.3.365 ) 19873108 52 mathis fh 1991 a generalized birthday problem . siam rev .
33 , 265 - 270 . ( doi : 10.1137 / 1033051 ) 53 nguyen lv et al .
2014 clonal analysis via barcoding reveals diverse growth and differentiation of transplanted mouse and human mammary stem cells . cell stem cell 14 , 253 - 263 . ( doi : 10.1016 / j.stem.2013.12.011 ) 24440600 54 benjamini y , hochberg y 1995 controlling the false discovery rate : a practical and powerful approach to multiple testing . j. r. stat. soc .
b 57 , 289 - 300 . 55 griffiths ajf , susan r , sean b , doebley j 2012 introduction to genetic analysis .
new york : w. h. freeman and company . 56 li b , dewey cn 2011 rsem : accurate transcript quantification from rna - seq data with or without a reference genome . bmc bioinformatics 12 , 1 ( doi : 10.1186 / 1471 - 2105 - 12 - 323 ) 21199577 57 germain ar. et al .
2012 identification of a selective small molecule inhibitor of breast cancer stem cells . bioorg. med. chem. lett .
22 , 3571 - 3574 . ( doi : 10.1016 / j.bmcl.2012.01.035 ) 22503247