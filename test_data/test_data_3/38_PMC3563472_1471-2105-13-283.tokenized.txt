bmc bioinformatics bmc bioinformatics bmc bioinformatics 1471 - 2105 biomed central 23113967 3563472 1471 - 2105 - 13 - 283 10.1186 / 1471 - 2105 - 13 - 283 research article denoising pcr - amplified metagenome data rosen michael j 1 mjrosen @ stanford.edu callahan benjamin j 1 benjc @ stanford.edu fisher daniel s 12 dsfisher @ stanford.edu holmes susan p 3 susan @ stat.stanford.edu 1 department of applied physics , stanford university , ca , us 2 departments of biology and bioengineering , stanford university , ca , us 3 department of statistics , stanford university , ca , us 2012 31 10 2012 13 283 283 3 4 2012 19 10 2012 copyright ( c ) 2012 rosen et al. ; licensee biomed central ltd .
2012 rosen et al. ; licensee biomed central ltd.this is an open access article distributed under the terms of the creative commons attribution license ( http :// creativecommons.org / licenses / by / 2.0 ) , which permits unrestricted use , distribution , and reproduction in any medium , provided the original work is properly cited .
background pcr amplification and high - throughput sequencing theoretically enable the characterization of the finest - scale diversity in natural microbial and viral populations , but each of these methods introduces random errors that are difficult to distinguish from genuine biological diversity .
several approaches have been proposed to denoise these data but lack either speed or accuracy .
results we introduce a new denoising algorithm that we call dada ( divisive amplicon denoising algorithm ) .
without training data , dada infers both the sample genotypes and error parameters that produced a metagenome data set .
we demonstrate performance on control data sequenced on roche 's 454 platform , and compare the results to the most accurate denoising software currently available , ampliconnoise .
conclusions dada is more accurate and over an order of magnitude faster than ampliconnoise .
it eliminates the need for training data to establish error parameters , fully utilizes sequence - abundance information , and enables inclusion of context - dependent pcr error rates .
it should be readily extensible to other sequencing platforms such as illumina .
background the potential of high - throughput sequencing as a tool for exploring biological diversity is great , but so too are the challenges that arise in its analysis .
these technologies have made possible the characterization of very rare genotypes in heterogeneous populations of dna at low cost .
but when applied to a metagenomic sample , the resulting raw data consist of an unknown mixture of genotypes that are convolved with errors introduced during amplification and sequencing .
there are two broad approaches to high - throughput sequencing of metagenomes : in amplicon sequencing ( also called gene - centric or gene - targeted metagenomics ) a pool of dna for sequencing is produced by using pcr to amplify all the variant sequences in a sample that begin and end with a chosen pair of primers [ 1 - 3 ] , frequently targeting hypervariable regions of the 16s ribosomal rna gene [ 4 ] ; in de novo genome assembly total dna is sequenced without amplification and reads are clustered into " species bins " , each providing the material for genome assembly by shotgun methods ( see table 1 in [ 5 ] for a list of such studies ). by trading off a broad survey of gene content for greater sequencing depth at the sampled loci , amplicon sequencing has the potential to detect the rarest members of the sampled community , but errors interfere more profoundly .
unlike genome assembly projects , where one needs only to determine the consensus base at each locus or decide whether a snp is present in a population , the space of possible distributions for the sample genotypes and frequencies is effectively infinite .
as a result , ambiguities in genome projects can usually be resolved by increasing the amount of data , whereas increasing depth ( as much as 106 in recent studies [ 6,7 ]) increases the number of both real and error - containing sequences and makes the challenge of distinguishing minority variants from errors only greater under amplicon sequencing .
greater depth therefore calls for progressively more sophisticated methods of analysis .
the analysis of amplicon sequence data typically begins with the construction of otus ( operational taxonomic units ) , clusters of sequences that are within a cutoff in hamming distance from one another .
otus serve to collapse the complete set of sequences into a smaller collection of representative sequences - one for each otu - and corresponding abundances based on the number of reads falling within each cluster .
otus were developed as a tool for classifying microbial species , but have also been repurposed to the task of correcting errors ; the sequences within an otu are typically interpreted as a taxonomic grouping without specifying whether the variation within an otu represents errors or real diversity on a finer scale than that chosen to define the otu .
if the scale of the noise is smaller than that of the clusters , then the construction of otus will appropriately group error - containing sequences together with their true genotype .
however , as sequencing depth increases , low probability errors outside the otu radius will start to appear , and will be incorrectly assigned to their own otu .
early studies using this approach on high - throughput metagenome data sets reported large numbers of low - abundance , previously unobserved genotypes that were collectively dubbed the rare biosphere [ 8 ] .
later , analyses of control data sets indicated that the diversity estimates in such studies tends to be highly inflated [ 9 ] and that results may lack reproducibility [ 10 ] .
the dual purpose of otus for correcting errors and for taxonomic grouping is appropriate when the diversity is being sampled at a coarse level , e.g. the frequency of different phlya .
however , when probing finer - scale diversity , otu methods have intrinsically high false positive and false negative rates : they both overestimate diversity when there exist errors larger than the otu - defining cutoff and cannot resolve real diversity at a scale finer than that ( arbitrary ) cutoff .
in response , a variety of approaches to disentangling errors from actual genetic variation have been proposed recently [ 11 - 14 ] .
these include multiple rounds of otu clustering with different hierarchical methods [ 11 ] , utilizing sequence abundance information implicitly by starting new clusters with common sequences [ 11,12 ] , and replacing otu clustering with an expectation - maximization ( em ) approach [ 13,14 ] .
accuracy has steadily improved , but all methods still fall short of maximizing the information acquired from metagenome data sets .
we believe that the way forward is to model the error process and evaluate the validity of individual sequences in the context of the full metagenomic data set , crucially including the abundances ( number of reads ) corresponding to each sequence .
major progress in this direction has been made recently by quince et al [ 13,14 ] .
in the specific context of pyrosequencing , often used for metagenomics , strings of the same nucleotide ( homopolymers ) are problematic , and quince et al incorporated a model of the distribution of homopolymer light intensities into an expectation - maximization ( em ) algorithm , pyronoise , which infers the homopolymer lengths of sequencing reads [ 13 ] ( q09 ) .
later , quince et al released ampliconnoise , an extension of pyronoise that includes rates of single - nucleotide substitution errors obtained from training data [ 14 ] ( q11 ) .
these methods were shown to more accurately infer the underlying sample genotypes than other approaches , demonstrating the worth of explicitly modeling errors .
however , the methods of quince et al. have several shortcomings that we would like to rectify : ( i ) as the size of sequence data sets grows , ampliconnoise becomes too slow to use in many applications ; ( ii ) estimation of error rates relies on the existence of training data specific to the pcr and sequencing chemistries used ; ( iii ) differentiation of fine - scale diversity is limited because read abundances are not fully utilized when calculating the distance between sequences and clusters ; ( iv ) the parameters that determine how conservative the algorithm is in inferring real diversity are ad hoc and cannot be tuned without experiment - specific training data .
we build on the error - modeling approach pioneered in ampliconnoise by developing a novel algorithm , dada , to denoise metagenomic amplicon sequence data that addresses the concerns raised above [ 15 ] .
we start with a parametric statistical model of substitution errors .
we incorporate this error model into a divisive hierarchical clustering algorithm that groups error - containing reads into clusters consistent with being derived from a single sample genotype .
finally we couple this clustering algorithm with the inference of the error parameters from the clustered data , and perform each step in alternation until both converge .
this method is presented below , and is shown to outperform previous methods in both speed and accuracy on several control data sets .
results model and algorithm we introduce a first - order model of the error process by assuming ( 1 ) each sequence read originates from a distinct dna molecule in the sample , and therefore that the presence of errors on different reads are statistically independent , and ( 2 ) errors on different sites of the same read are also statistically independent events .
the independence of errors across different reads relies on the independence of the pcr replication histories of those reads , a condition that holds when the total number of reads is significantly smaller than the total number of dna molecules present in the initial environmental sample and there are no strong amplification biases for sequences with errors .
under these conditions , the numbers of reads ( abundances ) of the error - containing sequences derived from a sample genotype follow the multinomial distribution , and the abundance r of each particular sequence is binomially distributed ( see methods ) with a probability lambdadetermined by the particular combination of errors in that sequence and a number of trials rho given by the total number of reads of its sample genotype .
these facts allow us to establish two statistics to evaluate the hypothesis that a collection of sequencing reads derives from a single sample genotype .
the abundance p - value determines when there are too many reads of the same sequence to be consistent with the error model , and the read p - value determines when a sequencing read is too far away to be an error from an inferred sample genotype .
these statistics serve as the basis of a sequence - clustering algorithm in which ( 1 ) reads are assigned to clusters , ( 2 ) a putative sample genotype is inferred for each cluster , ( 3 ) reads are reassigned to the cluster for which they are most likely to have resulted as errors from the inferred sample genotype , ( 4 ) the two p - value statistics are computed given the inferred sample genotypes and the clustering of the sequences ( 5 ) additional clusters are created if the clustering is statistically inconsistent with the error model ( as suggested by small p - values ) .
the full algorithm ( figure 1 ) combines this probabilistic sequence clustering with the estimation of substitution - error probabilities that are used to compute the p - values .
the algorithm begins by assuming all reads derive from a single sample genotype and estimates initial error probabilities given this assumption .
it then alternates between clustering the reads and re - estimating the error probabilities until it converges to a final set of mutually consistent clusters and error probabilities .
figure 1 dada schematic .
the basic structure of dada , an algorithm to denoise amplicon sequence data .
see algorithm algorithm 1 in the methods section for the pseudocode and a more detailed description .
the p - values we introduce two statistics for deciding that particular sequences did not arise from errors .
the read p - value is the probability of having observed at least one read of a sequence that is as improbable as the most improbable sequence amongst the observed reads .
this statistic treats each read as a separate event ( giving rise to its name ) and therefore does not utilize sequence abundance .
it results in a hard cutoff , lambda * , below which reads are decided not to be errors by dada .
this cutoff is set by the choice of a significance threshold omegar , the probability of having observed at least one read more unlikely than lambda * .
the abundance p - value , which is computed for each sequence individually , is the probability of having observed at least as many identical reads as we did of each sequence ( conditioned on having observed at least one ) .
the conservativeness of this measure is set by a significance threshold omegaa , the probability that at least one sequence should have been as overabundant as the most overabundant sequence .
the abundance p - value gives dada significantly greater sensitivity than previous methods .
figure 2 shows simulated and real data from a typical cluster of sequences that originated from a common genotype ( from the artificial data set , introduced below ) .
the abundance r and probability lambda of each sequence is plotted , as the ability of the read and abundance p - values to discriminate between errors and non - errors is easily visualized in this parameter space .
the regions where dada will declare a sequence to be an error or a real sequence are delineated by a dashed line for each of our p - value statistics .
the lambda values have been log - transformed and scaled by the most common error probability , making the x - axis interpretable as an effective hamming distance .
due to this scaling , it is also useful to interpret this plot in terms of real hamming distances , in which case the omegaaline represents a lower bound on dada 's resolution for any error at that distance .
figure 2 discrimination plots for a typical cluster in the artificial data set with 4691 reads .
( a ) simulated errors drawn from the error model and ( b ) the real errors in the cluster .
sequences ( diamonds ) are characterized by abundance and the probability lambdaper read of having been produced .
on the x - axis , we plot loglambdascaled by the most common error probability , ta - - > g , so that values can be interpreted as an effective hamming distance .
the dashed lines delineate the region - the lower left quadrant - where , for significance thresholds omegaaand omegar provided by the user , dada accepts that a sequence could have arisen via the error model .
the vertical dashed lines shows the lambdabelow which ( or the effective distance above which ) the read p - value rejects sequences as being errors , and the curved dashed line shows the abundances above which the abundance p - value rejects sequences as being errors for each value of lambda .
there are several sequences in the real data ( red diamonds ) that would be rejected by the abundance p - value at the omegaa = . 01 significance level ; we posit that early round pcr effects are a suitable candidate to explain these departures from the error model .
for both the real and simulated data , the abundance p - value does a good job of tracking the form of the abundances of the errors , and the read p - value sits to the right of all observed data .
for the real data , a small number of errors sit on or above the abundance discrimination line .
such errors were individually not expected to be observed at all , but ended up with a small number of reads larger than one .
this pattern was observed across many clusters , and we believe that it reveals the presence of small violations of our assumption of the independence between reads .
in particular , in a regime where the ratio of the number of error - free reads to the number of dna molecules in the sample that act as the basis for amplification is of order one or larger , then errors during early stages of pcr may be sampled multiple times in the sequence data .
as a result , the distribution for the number of reads of these errors may fall off much more slowly than what our model suggests .
to deal with this effect in this paper , we lowered the omegaathreshold using an ad hoc method ( discussed below ) to prevent excess false positives .
doing so did not affect dada 's ability to detect the genuine diversity in the data analyzed in this paper , which was typical of the data analyzed in many microbial metagenomics studies , but the sensitivity that is lost by using very small values of omegaa could be limiting for samples with even finer - scale diversity .
further analytics that model pcr as a branching process improve this current ad hoc threshold ( unpublished work ) .
treatment of insertions and deletions dada does not attempt to explicitly model the indel error processes , and indels do not contribute to the determination of whether sequences are related to each other via errors .
instead , sequences are aligned to each putative sample genotype , and are assigned to clusters on the basis of substitutions .
during the computation of p - values , we sum together the reads of sequences within each cluster that have the same set of substitutions ( forming structures that we call indel families ) .
the number of reads of each of these indel families , rather than those of the raw sequences , are the basis of our p - values ( see methods ) .
treating indels in this way does not affect the accuracy of dada for the test data sets analyzed here , as the sample genotypes all differed from each other by at least one substitution , and these provided enough information for dada to distinguish between them .
however , dada cannot distinguish between sequences that differ only by indels .
in such cases , if the amplicons being denoised are coding regions , frame information should be used for making decisions about whether particular indels are real or errors , but in order to denoise non - coding regions with pure indel diversity , dada is not sufficient in its current form .
preclustering prior to our probabilistic sequence clustering we divided the raw data into coarse 3 % single - linkage clusters ( with indels not contributing to distance ) , subsets for which each sequence is <= 3 % from at least one other sequence in its cluster and > 3 % from all sequences in other clusters .
due to its speed , we employed the esprit algorithm for this task [ 16 ] .
single - linkage 's propensity for chaining was advantageous in this circumstance , as all error - containing sequences are very likely to be in the same cluster as their originating sample genotypes ; for a sample genotype and one of its errors to end up in different clusters , the error would have to be >= 3 % from the nearest error clustered with that genotype , corresponding to a large gap in the error cloud , which is unlikely under our error model .
clustering each precluster is partitioned into sets of sequences that are conjectured to contain all errors arising from different sample genotypes .
this partition is initialized to a single cluster containing all sequences .
two procedures then alternate .
first , the indel family most unlikely to have resulted from errors is split off into a new cluster .
sequences then move between clusters based on the probability that they were generated as errors by each one , and the consensus sequence for each cluster is updated until there are no remaining reassignments that can improve the probability of the data .
this second step is analogous to the assignment and update steps of standard k - means clustering .
this alternation stops when the partition of the sequences fits with the current error model at the significance levels provided by the user .
accuracy we evaluated the accuracy of dada by denoising three of the data sets in q11 used to demonstrate ampliconnoise 's accuracy relative to the earlier slp and denoiser algorithms .
these data are derived from mixtures of known clones that were amplified together and sequenced on the 454 platform , and consisted of different hypervariable regions of the 16s rna subunit of bacterial ribosomes ( 16s rrna ) , which are commonly used as a proxy for phylogenetic diversity in metagenomic studies [ 4 ] .
two of the data sets , divergent and artificial , with 35,190 and 31,867 reads , were sequenced with the gs - flx chemistry and were truncated at 220 nucleotides .
they were constructed by amplifying the v5 region of the 16s rrna gene from 23 and 90 clones , respectively , isolated from lake water .
the divergent clones were mixed in equal proportions and are separated from each other by a minimum nucleotide divergence of 7 % , while the artificial clones were mixed in abundances that span several orders of magnitude , with some of the clones differing by a single snp .
the other data set , titanium , with 25,438 reads , was sequenced with the newer titanium chemistry and was truncated at 400 nucleotides .
it contains v4 - 5 16s rrna genes from 89 clones isolated from arctic soil with varying abundance and genetic distances , similar to the artificial set .
all data sets had undergone filtering of reads deemed to be of low quality prior to application of ampliconnoise in q11 , so for purposes of comparison , we denoised the same set of filtered reads .
the presence of a small number of low - quality reads in 454 data has been previously demonstrated [ 17 ] , and as we do not expect these to be well described by our error model , we encourage the use of such quality filtering before applying dada to non - test data .
as slp and denoiser were already demonstrated to be less accurate than ampliconnoise on these data , we include here dada 's performance only relative to that of ampliconnoise .
there were six other data sets presented in q11 of v2 regions from a gut microbial community , but these had such an overwhelming number of chimeric sequences ( reported to be as high as 85 % in q11 ) , which neither dada nor ampliconnoise attempts to address , that we opted not to include these data sets in our analysis .
tuning algorithmic sensitivity dada employs two tunable parameters that determine how conservative or liberal the algorithm is to be in deciding whether particular sequences could have resulted from errors : omegaa , and omegar , the significance levels for its abundance and read p - values .
decisions about singletons , the sequences represented by a single read , depend on omegar , whereas decisions about sequences with several reads depend on omegaa .
the two values may be tuned independently to match the priority being placed on capturing the rarest and more common diversity .
due to early - stage pcr effects discussed above , it was necessary to use omegaa significance levels lower than typical values .
in order to select such values , we first performed a loose clustering of each data set with larger values of omegaa and omegar and then made histograms of the omegaathresholds that would be required for each cluster to be reabsorbed into some other cluster ( figure 3 ) .
if there are errors with moderate statistical deviations from our model , we expect that these will show up as a tail of increasingly small p - values that will disappear smoothly as we lower the omegaa threshold .
thus , we looked for the first large gap in these histograms that would suggest all such model departures had been captured .
such a gap occurs at omegaa = 10 - 15 for the divergent data , omegaa = 10 - 40 for the artificial data , and omegaa = 10 - 100for the titanium data .
we used these values in the analysis that follows , but also clustered all three data sets with omegaa = 10 - 100and found that the results were unchanged ( see appendix appendix 2 : omegaa robustness ) .
this suggests that omegaa = 10 - 100is a reasonable default value to use when clustering diversity at this scale , even though higher resolution may be achieved by the method outlined above .
for non - test metagenome data that is more diverse and less oversampled , we have seen evidence that using much larger values of omegaa ( such as . 01 ) may be possible without compromised accuracy , but in such cases it is always advisable to make histograms of the type above to ensure that there is not an excess of clusters that would vanish if omegaa were lowered slightly .
figure 3 ad hoc omegaa choices for the divergent ( a ) and ( d ) , artificial ( b ) and ( e ) , and titanium ( c ) and ( f ) data sets .
( a ) - ( c ) are histograms of the omegaathreshold at which each cluster derived from a run of dada with omegaa = omegar = 10 - 3rejoins some other nearby cluster .
genuine genotype counts are shown in blue and false positive counts are shown in red .
the first gaps in these histograms were used to pick omegaathresholds for reclustering the data , and are indicated by vertical dashed lines .
( d ) - ( f ) show the omegaadiscrimination lines for the largest cluster in each data set ( with 2294 , 5479 , and 1095 reads ) for omegaa = 10 - 3and the associated ad hoc omegaavalues .
we did not observe any significant departures in these data from our model that would affect the read p - values , and it was therefore possible to maintain the interpretation of omegaras a significance threshold .
as a result , for these data , which contain <= 50 preclusters that were clustered separately by dada , we set omegar = 10 - 3 so that the probability of having a false positive would be <= 5 % for each data set .
false negatives and false positives the purpose of dada ( and ampliconnoise ) is the inference of the genotypes present in the underlying sample from a set of noisy ( error - containing ) sequencing reads .
there are two types of errors that such an algorithm can make : false positives in which a sample genotype is inferred that was not present in the sample , and false negatives in which the algorithm fails to infer a sample genotype that was present in the sequencing reads .
the tradeoff between false positives and false negatives in the two algorithms can be controlled by the algorithmic parameters , depending on which type of error presents more of a problem to the user .
we present , in table 1 , a comparison of the false positives and false negatives for dada and ampliconnoise applied to the control data sets described above .
note , however , one important detail : these algorithms are designed to remediate substitution and indel errors , not all possible errors .
in particular , we found that contaminants , chimeras , and pathological homopolymer errors contributed to these sequencing data sets .
using ad hoc methods , discussed in appendix appendix 1 : chimeras , contaminants , and missing or incorrect sanger sequences , we accounted for these additional error sources , and did not penalize either algorithm for them .
table 1 false positives and false negatives dada ampliconnoise sample false pos false neg false pos false neg divergent 0 0 2 0 artificial 1 2 8 7 titanium ( s10 ) 6 0 8 9 titanium ( s25 ) 23 4 dada is more accurate in its inference of the sample genotypes than is ampliconnoise on every data set .
the difference is especially strong among false negatives , where dada successfully identifies virtually all sample genotypes ; dada 's only two false negatives , both in the artificial set , result from pathological alignment issues between sequences that differ only in the last two bases .
the differences in the nature of the false positives and negatives made by dada and ampliconnoise are shown in figure 4 .
dada produces one false positive in the artificial data : a sequence with 268 reads that is a single substitution from a sample genotype with only 210 reads .
due to its vast abundance , this is unlikely to be an error , and we speculate it may represent a polymorphism that arose early in the growth of this clone .
ampliconnoise produces eight false positives in the artificial data : all sequences with 1 - 4 reads that are ( except for one ) 1 - 4 substitutions away from clusters with a few hundreds of reads .
although these sequences were not atypical errors as judged by dada due to their low abundances , ampliconnoise calls them real as a result of setting a narrow error radius that is needed to prevent additional false negatives .
the differences between the errors made by the two algorithms is less clear in the titanium data set , but dada outperforms ampliconnoise in both fps and fns .
we included ampliconnoise 's results for the titanium data set for both parameter settings included in q11 : the sigma =. 04 clustering ( s25 ) , which produces only four false negatives , leads to many false positives similar in nature to those of the artificial clustering - low abundances and a small number of substitutions away from large clusters ; the sigma =. 1 ( s10 ) clustering produces many fewer false positives but misses nine sample genotypes .
figure 4 nature of false positives and false negatives of dada and ampliconnoise on artificial and titanium data sets .
false positives are characterized by the number of reads associated with the falsely inferred genotype r , the distance to the nearest real sequence d , and the number of reads associated with that nearest real sequence r. false negatives are characterized by the number of reads that matched the missing genotype r , the distance from that missing genotype to the nearest inferred genotype d , and the number of reads associated with that nearest inferred genotype r. speed we evaluated the speed of dada applied to the artificial data , which was used to profile ampliconnoise in q11 ( table 2 ) .
esprit was run on a single core of an amd phenom ii 3.2ghz running ubuntu and dada was run on a macbook pro with an intel core 2 duo 2.4 ghz .
table 2 cpu times for clustering artificial community function cpu time ( seconds ) esprit kmerdist 74.80 needledist 924.68 total 1002.68 dada n - w alignments 97.81 read p - values 58.84 total 296.64 esprit + dada 1.30x103 ampliconnoise 7.57x104 the cpu times for a few significant subroutines within dada and esprit as well as their total cpu times .
dada is currently written in matlab , but sequence alignments and the construction of indel families were bottlenecks that we reimplemented as mex ( matlab executable ) c programs .
the majority of the time to run our denoising pipeline on the artificial data set is spent on esprit 's performance of pairwise alignments during the single - linkage pre - clustering step ( needledist ) .
a newer version of esprit promises to be released soon that may dramatically lower this time [ 18 ] .
if additional speedups are needed as data sets grow , it should be possible to replace the global alignments of esprit by banded alignments that would be guaranteed to produce the same clusters if the width of the band is equal to the cluster radius , and would have have roughly linear ( in sequence length ) rather than quadratic , running time .
nonetheless , for these data dada already gives a 60 - fold speedup over ampliconnoise , making jobs that required a 64 - core cluster to run ampliconnoise appropriate for a laptop running dada .
as read lengths continue to grow , we expect the time complexity of dada to be affected in two primary ways .
first , because the complexity of the needleman - wunsch alignment algorithm used by both dada and esprit scales with the product of the lengths of the input sequences [ 19 ] there will be a quadratic slowdown with increasing read length unless heuristics are employed .
on data sets comparable to those analyzed here , alignments consume the majority of algorithmic time and this scaling will dominate in the near future .
second , our current implementation for computing read p - values has both time and space complexity that grows very rapidly with read length ( it is asymptotically o ( l11 )) .
this was not strongly limiting for these data , but in case it should become so as reads become longer , we have explored the use of a continuous approximation for the error probabilities that may alleviate this problem .
pcr substitution probabilities : symmetries and nearest - neighbor context - dependence dada not only infers sample genotypes , it also infers the substitution error probabilities caused by the amplification and sequencing processes .
the substitution error probabilities inferred by dada for all three data sets exhibit an approximate symmetry under complementation of the two bases involved .
for example , the a - - > g probability is close to the t - - > c probability .
this symmetry is expected if substitution errors predominantly arise during pcr amplification because substitution errors during pcr can be the result of either of two different mis - pairing events ( from when the sequence is being copied to the opposite strand , or from when it is being copied back ) , and complementary substitution errors share causal mis - pairing events ( see figure 5 for a schematic ) .
as it was not imposed , and the identities of the original genotypes were not known to the algorithm , the symmetry is a highly non - trivial check on dada 's ability to learn error probabilities without training data .
additionally , the inferred substitution probabilities were similar across the data sets , and especially so between divergent and artificial , which were generated with the same pcr protocols .
figure 5 two paths to the same error .
different mispaired bases ( red ) produce the same double stranded product once paired with complementary bases ( green ) so that each path leads to an atg - - > agg substitution error on one strand and a cat - - > cct on the other .
the probability of these two errors is therefore expected to be very similar .
we also found that the nearest - neighbor nucleotide context affects the probability of substitution errors .
we therefore introduced context - dependent substitution probabilities into dada , allowing for dependence on the nucleotides immediately preceding and following the substituted nucleotide .
such probabilities are expected to exist in reverse complementary pairs for the same reason given for the context - independent case ( again , see figure 5 ) ; the lir - - > ljr probability is expected to be similar to the lir - - > ljr probability where lir denotes the reverse complement of lir .
the degree of symmetry in the inferred probabilities , both context - independent and context - dependent , are shown in figure 6 for all three data sets .
figure 6 error probability symmetries for divergent ( a ) and ( d ) , artificial ( b ) and ( e ) , and titanium ( c ) and ( f ) data sets .
( a ) - ( c ) : context - independent substitution error probabilities inferred by dada with 95 % confidence intervals based on binomial sampling error .
note the approximate symmetry between i - - > jand i - - > j probabilities ( which show up contiguously along the y - axis ) , where i denotes the complement of nucleotide i .
( d ) - ( f ) : all 96 reverse - complementary pairs of context - dependent error probabilities inferred by dada for each data set .
for each pair , the probability of the error away from an a or c is plotted on the x - axis and the error probability away from t or g is plotted on the y - axis .
the pairing between these probabilities - seen by the tendency to lie along the diagonal - is stronger for the largest probabilities , which have the least sampling noise .
the colors signify complementary pairs of errors red = ( a - - > g,t - - > c ) cyan =( c - - > t,g - - > a ) green =( a - - > t,t - - > a ) black =( c - - > a,g - - > t ) blue =( a - - > c,t - - > g ) purple =( c - - > g,g - - > c ) .
the magnitude of context - dependence for these data was moderate ( most context - dependent probabilities differed by < 50 % from context - independent ones ) as seen in the spread of points along the diagonal in figure 6d,e,f . as a result , maintaining separate probabilities for different contexts did not affect the inferred sample genotypes .
nonetheless , that dada was robust to significant variation in its parameters is a strong check on the stability of its sample inference .
we have worked with data for which context - dependence is large and has a strong effect on clustering .
therefore , we leave use of context - dependence as an optional feature of dada , either as a consistency check , or when justified by the amount and nature of the data .
but a caution is in order : with modest sized data sets , or if the sequences are too similar , use of the context - dependent rates could result in over - fitting and calling too many errors .
however if this did occur , the expected complementarity symmetry of the inferred error probabilities would be unlikely to obtain unless the sequences were read in both directions .
discussion dada explicitly incorporates read abundance when deciding whether sequences are genuine or errors ; if there are many identical reads of a sequence , dada will be more likely to infer an underlying sample genotype , even if individually those reads would be consistent with being an error from a nearby genotype .
furthermore , dada implicitly assumes , via the error model , that reads near highly abundant sequences are far more likely to be errors .
in contrast , previous methods have typically treated each read independently .
ampliconnoise partially incorporates abundance by weighting the prior probability that a read belongs to a cluster by the frequency of that cluster , but this is weaker than dada , where dependence on cluster size shows up in a binomial coefficient ( see methods ) , especially for high - abundance errors. by using both sequence identity and abundance in this way , dada is able to disentangle real diversity from errors at finer scales than previous methods , even when tuned to be very conservative .
however , full incorporation of abundance information makes dada sensitive to early - stage pcr effects and the mis - estimation of error probabilities .
the problem of early - stage effects is particularly pronounced in these data : when clustered with omegaa = omegar = 10 - 3 , the artificial data produces 68 false positives ( we would have expected no false positives if the model assumptions were not violated ) .
the majority of these sequences have 2 - 5 reads and 2 - 4 errors .
such problems would be typical of moderately oversampled pcr , the regime in which initial sample molecules are typically sampled multiple times , allowing a single error during early stages to show up in more than one read .
in lieu of an abundance statistic that appropriately compensates for this affect , we deal with this problem by lowering the sensitivity of the algorithm by tuning down omegaa .
further , because the probability given to each sequence scales as the error probabilities to the power of the number of reads ( see methods ) , if certain error parameters are larger than estimated in certain contexts , then the statistical significance of an error with many reads can be substantially overestimated .
this problem gets progressively worse for deeper data sets , as all one - away errors begin to take on many reads .
in anticipation of this problem , we have introduced nearest - neighbor context - dependence of error rates ( see methods ) .
these had no impact on the final clustering for the test data presented , but in other data sets with larger context - dependent effects , we found a reduction in diversity estimates when context - dependence was included ( data not shown ) .
dada is a divisive hierarchical clustering algorithm : all sequences are assigned to a single cluster that is subdivided until the clustering fits an error model .
previous methods , including ampliconnoise and simple otu - clustering , have predominantly taken the opposite , agglomerative approach , which starts with too many clusters and merges them until some condition is met .
this gives dada a practical advantage , as the computational and space requirements ( especially the number of alignments to perform and store ) scale with the square of the initial number of clusters [ 20 ] .
the typical problem of divisive methods - that the number of possible splittings is too large - is handled in dada by seeding new clusters with sequences that are identified as not being errors and allowing other sequences , e.g. errors associated with the new clusters , to relocate if they become more probable by doing so. finally , dada uses unsupervised learning to acquire error probabilities from the data that it is given .
as pcr protocols vary in their choice of polymerase and number of rounds , these parameters vary by data set , perhaps greatly .
this makes the universality of dada 's approach especially attractive , and will be important as new sequencing methods come into use such as longer read - length and paired - end illumina that commonly make substitution as well as indel errors [ 21 ] .
while it now relies on training data to establish error parameters , ampliconnoise could be embedded in the same procedure of estimating error probabilities after each successive round of clustering , but this would multiply the computation requirements by a factor of the number of rounds of re - estimation , compounding the problem of its slower speed .
conclusions otus serve as a rough analogue for microbes of the more clearly defined taxonomic groups of higher organisms .
however , the repurposing of the otu concept to the problem of inferring sample genotypes from error - prone metagenomic sequence data has serious and inherent shortcomings .
the absence of an error model causes estimates of diversity , especially species richness , to depend strongly on experimental variables such as the size of the data set , the length of the region sequenced , and the details of the pcr / sequencing chemistry .
these shortcomings are not amenable to simple fixes ; it is not possible to separate real diversity from errors using an otu approach when the diversity and the errors exist at similar scales ( as measured by hamming distance ) , as is the case in many metagenomic studies .
pyronoise and ampliconnoise have demonstrated the usefulness of denoising sequence data with statistical , physically - based error models .
these methods are based on the classical statistical technique of expectation - maximization .
we have presented an alternate approach , dada , which is more targeted to the particular task of producing conservative estimates of diversity from noisy sequence data .
it is much faster and more capable of resolving fine - scale diversity while maintaining a lower false positive rate .
we did not achieve our goal of complete freedom from ad hoc parameters in this work .
even though omegaa , our input parameter , has a simple probabilistic meaning that is data set independent , there are corrections to our pcr model , and as a result omegaa takes on an ad hoc quality in this analysis .
nonetheless , omegaacan be coarsely tuned from the data itself in the way shown .
alternatively , for conservative diversity estimates , omegaa may be set to very small values ( such as 10 - 100 ) , and the resolution of the algorithm may be directly quantified .
dada not only guesses what is there , but knows what would have been missed if it were present , making omegaa ad hoc but not arbitrary .
much work remains to be done , and it is not yet clear how the algorithms will fare with extremely rich fine - scale diversity as occurs for the antibody repertoire of b - cells and t - cells of the human immune system [ 22,23 ] .
dada must be equipped with statistics that correctly describe the abundance distribution of sequencing errors when a realistic model of pcr is used in which some reads are the result of shared lineages .
more sophisticated methods for chimera detection that explicitly parameterize the chimera formation process analogously to the substitution and indel processes are also needed .
finally , these methods must be fully adapted and tested on sequencing platforms other than roche 's 454 .
methods general notation from a sequencing data set s ={ sx,rx } , where rx is the number of individual reads of each distinct sequence sx , we would like to construct an estimate g ={ galpha } of the set of genotypes in the sample that gave rise to s. with this aim , we construct a partition b of the sequences { sx } where each balphainb is a collection of sequences hypothesized to have originated from a common galpha , and notate the number of reads assigned to galphaby rhoalpha = sumx | sxinbalpharx .
because each sx can reside in only one balpha and it is assumed that galpha is the source of all sx in balpha , this framework does not allow for multiple galpha to contribute reads to the same sx. allowing the latter is likely to affect g only in special cases and adds complications .
treatment of insertions and deletions : the construction of indel families in addition to substitution errors , reads acquire insertions and deletions ( indels ) during amplification and sequencing .
both substitutions and indels could be used to parameterize an error model , but here we focus on substitutions and do not attempt to characterize the statistics of indels .
instead , we collapse together all the reads of sequences within each balphathat differ from each other only by the location of indels in their alignments to galpha , forming subsets of each balpha that we call indel families .
we call the indel families f ( s,b,g )={ sy,ry } , where each sy refers either to a subset of some balpha or the sequence identical with galpha except for the substitution errors of its constituents , and ry is the number of reads in the family .
the ry of each indel family will be used to test whether b agrees with an error model , i.e. whether the substitution errors observed on the families in each balpha was not too improbable under an error model of substitution errors .
alignments between sequences and each galpha in this paper took place with a scoring matrix of 5 + logt ( to make them comparable with ncbi blast 's nuc.4.4 matrix [ 24 ]) , where t , introduced below , is a matrix of substitution error probabilities .
we used a gap penalty of - 4 and a hompolymer gap penalty of - 1 .
the gap penalty had to be less than half the smallest mismatch score or alignments would favor a pair of indels to that mismatch .
the worst mismatch score tended to be about - 6 , and so - 4 was chosen as a gap penalty to allow as many gaps as possible without making any mismatches prohibited within alignments .
the independence between substitution errors on different reads implies a binomial distribution for the number of reads of each family if the occurrence of substitution errors on different reads are independent events , then each read of genotype galpha has an i.i.d. one - trial multinomial distribution with parameters lambda ={ lambdayalpha } , which we call the genotype error probabilities , to belong to each indel family sy. lambda also parameterizes the probability distribution for ry , the number of reads of family y : if sysubset / equalbalpha , then because ry is the sum of rhoalpha bernoulli random variables each with success probability lambdayalpha , it follows the binomial distribution , ry ~ bin ( lambdayalpha,rhoalpha ) .
the assumption of independence between reads does not hold if early round pcr errors may be sampled multiple times in the final sequence data .
then , if we condition on having observed a particular error on some other read , the probability to observe it additional times is increased .
lambda may be constructed from simple nucleotide transition matrices if the occurrence of substitution errors on different sites of the same read are independent events that do not depend upon the absolute position of the sites , then we can write each lambdayalpha in terms of a homogeneous markov chain t , whose elements we call nucleotide error probabilities .
the simplest useful model of this sort is the 4x4 transition matrix tij = p ( j | i ) with , for example p ( c | a ) the probability for taking nucleotide a in the sample to c in the data ( i,j will always index nucleotides ) , and this is the model used by ampliconnoise .
these probabilities generate the genotype error probabilities lambda via ( 1 ) lambdayalpha = productntalphanyn where alphan and yn denote the nth nucleotides of galpha and sy ( also let lambdaxalpha = lambdayalpha for all x | sxinsy , used in algorithm algorithm 1 ) .
if the nucleotide error probabilities at each site can depend upon the nearest - neighbor flanking nucleotides , we can keep track of a transition matrix t ( l,r ) for each possible ( l,r ) pair of flanking nucleotides such that tij ( l,r )= p ( ljr | lir ) , with p ( atc | agc ) the error probability for taking agc to atc .
this generalization , which we call context - dependence , increases the number of free parameters from 12 to 192 : there are 16 possible pairs of flanking nucleotides each with a 12 free parameter stochastic matrix .
dada may be run with or without context - dependence , but due to the risk of overfitting and because we saw no substantial effect on the outcome of clustering when it was used , context - dependence was not used to produce the results presented in this paper .
assessing fit with an error model via tail probabilities in order to assess whether g and b fit the error model lambda , we introduce two statistics , pyand qalpha : py is the probability of having seen at least ryreads of sy given that we saw at least one and qalphais the probability of having seen at least one read with a genotype error probability at least as small as the smallest genotype error probability of an observed indel family in balpha , lambdaalpha *= miny | sysubset / equalbalphalambdayalpha .
py : the abundance p - value call ry + the number of reads of sygiven that we observed at least one : p ( ry += r )= p ( ry = r | r > 0 )= p ( ry = r ) 1 - p ( ry = 0 )~ bin ( lambdayalpha,rhoalpha ) 1 - 1 - lambdayalpharhoalpha given the definition of pyabove , py = p ( ry +>= ry )= sumr = ryinfinityp ( ry += r )= sumr = ryinfinityrhoalpharlambdayalphar1 - lambdayalpharhoalpha - r1 - 1 - lambdayalpharhoalpha we refer to this as the abundance p - value because it evaluates the probability of having observed more extreme abundances under the null hypothesis that each rywas generated by the error model .
because one abundance p - value is generated for each indel family , we use a bonferroni correction and compare each pywith omegaa /| f | , where omegaa is a joint significance threshold that is provided to dada by the user .
if we had not conditioned on having observed at least one read of each family , then the unobserved families would not have born any significance ( they would all have py = 1 ) , but before looking at the data these families could have been significant .
this would create a difficulty in choosing an appropriate multiple hypothesis correction ; a naive bonferroni correction of productalpha4lalpha with lalpha the length of galpha , which treats all possible families as tested hypotheses , would deprive the p - value of any statistical power .
conditioning on ry > 0 and evaluating only the observed sequences avoids this complication .
however , any family with ry = 1 obtains py = 1 regardless of the smallness of lambdayalpha , which necessitates our second statistic , qalpha .
qalpha : the read p - value for each cluster balpha , we compute the probability qalpha , which we call the read p - value , that there is at least one read with a genotype error probability at least as small as lambdaalpha * .
let lalphabe a random variable representing the smallest genotype error probability when rhoalpha reads of galpha are generated according to lambda .
then qalpha = p ( lalpha <= lambdaalpha *)= 1 - sume | lambdaealpha > lambdaalpha * lambdaealpharhoalpha where e iterates over all 4lalpha sequences , and lambdaealphaare the genotype error probabilities of these sequences .
evaluating the sum in this form would be computationally wasteful ; instead we iterate over sets of sequences that share the same types of substitution errors .
we index these sets by 4x4 off - diagonal matrices gamma whose elements gammai != jspecify the number of i 's on a genotype that appear as j 's on the sequence .
the genotype error probability for sequences of type gamma away from genotype galphais lambda0alphaxlambdagamma with lambda0alpha = productitiinalphai the probability of having no errors ( where nalphai is the number of nucleotides of type i on galpha ) and lambdagamma = producti,jtijtiigammaij , which is independent of alpha .
we also need the number of distinct sequences of type gammafor each galpha , which we call the degeneracymgamma ( alpha ) of gamma on galpha .
this is computed by taking a product over multinomial coefficients : mgamma ( alpha )= productinalphai !( nalphai - sumjgammaij )! productjgammaij ! .
rewritten as a sum over gamma , qalphabecomes qalpha = 1 - lambda0alphasumgamma | lambdagamma > lambdaalpha */ lambda0alphamgamma ( alpha ) lambdagammarhoalpha vectors of lambdagamma and mgamma ( alpha ) can be computed starting with gammarepresenting the more common errors and extended to more rare errors as needed to compute p - values for smaller lambdaalpha * .
finally , rather than maintaining vectors of mgamma ( alpha ) for each alpha , we keep one for each of a small number of possible base compositions and interpolate between the qalphathat would result from each of these in order to approximate the qalpha that would result from the exact base composition of galpha .
because one qalpha is generated for each balpha , the qalpha are then compared with omegar /| b | , where omegar is another joint significance threshold provided to dada by the user , in order to determine whether any lambdaalpha * are too small to be the result of errors .
maximum likelihood estimate ( mle ) of error probabilities after forming a partition b of s that fits the error model generated by t , dada updates t to its maximum likelihood estimate given this partition .
the likelihood of t given s and b is l ( t | s,b )= productalphaproductx | sxinbalphaproductntalphanxnrx where alphan and yn denote the nth aligned nucleotides of galphaand sx. for the case without context - dependence , the likelihood may be rewritten as l ( t | s,b )= productiproductj != itijnij1 - sumj != itijnii where nij is the total number of js in s that result from is in g according to b. the maximum likelihood equations for the off - diagonal elements of t , dl ( t | s,b ) dti != j ({ t ^ mle,ij })= 0 , are solved by maximum likelihood estimate t ^ mle,i != j = nijni where ni = sumjnij ( the diagonal t ^ mle,ii = 1 - sumj != it ^ mle,ij are set by normalization ) .
analogously , for the context - dependent case , the mle estimate is t ^ mle,ij ( l,r )= nlijrnlir where i != j , l,r are any pair of left and right flanking nucleotides , nlijr is the total number of ljr codons in s that result from lir codons in g according to b , and nlir = sumjnlijr .
algorithm for inferring the sample genotypes and error probabilities the p - values py and qalpha are the basis for an algorithm that alternatively updates b and the nucleotide error probabilities t , which may be specified by the user as either context - independent or dependent , denoting their values after t iterations by bt and tt , in order to improve the likelihood of the data .
this is similar to the hard - em algorithm except that the partition bt at each step is the result of a model - based divisive hierarchical clustering approach and does not maximize the probability of s given tt. the algorithm requires two user inputs , omegaaand omegar , which are the joint significance thresholds for the abundance and read p - values .
algorithm 1 dada sequence clustering algorithm [ 15 ] t0 = t ^ mle ( b0 ) , where b0 is the trivial partition containing the entire s. t < - - 1 repeat bt < - - b0 repeat ifbt != b0 start a new cluster within bt containing the most statistically inconsistent family .
repeat update { galpha } rhoalpha < - - sumx | sxinbalpharx lambdaxalpha = productntalphanxn ( or talphanxn ( alphan - 1,alphan + 1 ) if context - dependence is on ) each sxjoins balphawhere alpha = arg maxalpha ''( rhoalpha '' lambdaxalpha '') untilbt is unchanged update { py } and { qalpha } untilminpy >= omegaa /| f | and minqalpha >= omegar /| b | tt + 1 = t ^ mle ( bt ) t < - - t + 1 untilt has converged there are three levels of nesting , each beginning with a repeat statement in algorithm algorithm 1. from outer to inner , we give a qualitative description of their purpose : 1 .
starting with t0 , the maximum likelihood nucleotide error probabilities given the trivial partition b0 of all sequences into a single cluster , the outermost loop iteratively updates b and t until t converges .
we have observed cases where t does not completely settle down but fluctuates within a small basin of attraction .
to deal with such cases , dada terminates if t ever returns to a previously held value or || tt - tt - 1 || < in , where the tolerance in = 1e - 9 is used as a default and may be altered by the user .
if convergence has not been reached in ten rounds , dada terminates with a warning message .
2. for each tt , the next loop begins with the trivial partition , bt = b0 , and adds blocks to bt until the { py } and { qalpha } do not allow rejection of the error model at joint significance levels omegaaand omegas .
new balphat are seeded by the sequences in families with the smallest p - values .
if statistically significant families exist under both p - values , then those significant under the abundance p - value take priority for starting new clusters .
this approach avoids the need to put an explicit penalty on the number of blocks of b , instead aiming for the smallest b under which the current error model cannot be rejected .
3. after adding a new block balphat to bt , the innermost loop raises the probability of the data by reassigning each sequence to the block that would produce ( under the error model ) the largest expected number of reads of that sequence .
the putative genotype of a cluster , galpha , is also updated if a cluster balphahas a new consensus sequence .
this continues until sequences cease changing clusters .
appendix 1 : chimeras , contaminants , and missing or incorrect sanger sequences there are disagreements between the sanger sequences of the clonal isolates used to construct the data sets and the denoised sequences of dada and ampliconnoise that are due to sources other than pcr substitutions and pyrosequencing errors .
these include contamination , chimeric sequences that result from the co - amplification of genomes with regions over which they exactly match , sanger errors , the absence of any reads of two sample genotypes , and disagreements between the sanger sequences and majority of the 454 reads about the lengths of several homopolymers ( for example , not a single 454 read matched four of the sanger sequences while many were identical except for the presence of a single deletion on a g homopolymer ) .
in order to evaluate the relative performance of dada and ampliconnoise as denoising algorithms , it was necessary to identify which disagreements between sanger and denoised sequences were due to these sources and which , falling outside these categories , were due to algorithmic shortcomings .
we chose criteria for classifying errors of these types and applied them to the sequences denoised by dada and ampliconnoise ( table 3 ) .
table 3 additional sources of noise and false positives dada ampliconnoise sample denoised clone chim contam other denoised clone chim contam other divergent 43 23 18 2 0 51 23 23 3 2 artificial 65 50 14 0 1 73 44 21 0 8 titanium ( s10 ) 274 80 185 3 6 163 71 82 2 8 titanium ( s25 ) 304 76 203 2 23 for each data set and both algorithms : the total number of denoised sequences , the number that matched one of the sanger sequenced clones , the number classified as chimeras , the number classified as contaminants , and all other false positives .
we began by correcting possible errors in the sanger sequences .
in the divergent and artificial data sets there were disagreements between very high abundance denoised sequences and their nearest neighbor sanger sequences ( 12 / 23 divergent sanger sequences and 63 / 90 artificial sanger sequences ) .
the denoised sequences were a consensus of thousands of pyrosequencing reads and did not differ from the sanger sequences near homopolymers ; rather , all disagreements were non - homopolymer related deletions near the starts of the reads .
it was confirmed ( chris quince , personal communication ) that all bases of sanger sequences aligning to sites within 13 nucleotides ( nts ) of the forward primer of the pyrosequencing reads had been removed in q11 , and so were likewise removed in all our analysis .
in the titanium data , the denoised sequences closest to eight of the sanger sequences had over 100 reads but differed from them by one or two homopolymer deletions at several long homopolymers .
dada and ampliconnoise ( s10 and s25 ) agreed on the presence of the deletions in all of these sample genotypes , and there were more copies of the error - containing sequences than the sanger sequences in the raw data ( table 4 ) , suggesting either an error probability greater than 50 % for the combined amplification / pyrosequencing process or problems with the sanger sequences .
therefore , we did not consider these disagreements to be false positives or false negatives for either algorithm .
table 4 titanium genotypes with more error - containing than sanger sequence matching reads reads of nearby pyrosequence reads of sanger sequence errors 5 0 g8 - - > g7 ( 301 ) , g5 - - > g4 ( 354 ) 70 0 g6 - - > g5 ( 133 ) 75 1 c7 - - > c6 ( 313 ) 21 18 g6 - - > g5 ( 133 ) 14 0 g6 - - > g5 ( 133 ) 80 0 g6 - - > g5 ( 133 ) 77 3 g6 - - > g5 ( 133 ) 80 1 g6 - - > g5 ( 133 ) the difference between the sanger and 454 sequences and their locations are given .
for example , g6 - - > g5 ( 133 ) means that a homopolymer beginning at the 133rdbase with 6 gs in a sanger sequence showed up as 5 gs in most of the pyrosequence reads .
all disagreements consist of deletions in the 454 reads on long g / c homopolymers relative to the sanger sequences , and the majority of the disagreements occurred on one locus , site 133 .
next we identified chimeras : sequences consisting of two sections with one section a close match to one sample genotype and the other a close match to a second sample genotype .
these can be produced in substantial quantities by pcr [ 25 ] .
analogously to q11 , for each denoised sequence we computed the hamming distance to the nearest sanger sequence and to the nearest exact chimera by considering all possible breakpoints between all pairs of sequences of higher abundance ( a chimera will have fewer reads than its parents unless it acquires substantial pcr bias ) .
for a denoised sequence to be classified as a chimera , we required that it be at least 3 nts closer to the nearest exact chimera than the nearest sample genotype and within 5 nts of the optimal chimera ( also analogous to the procedure used in q11 ) .
we waived the 3 nt improvement criteria for denoised sequences that were identical to exact chimeras , which occurred for some particularly highly abundant chimeras between closely related sample genotypes .
all data sets had a large number of chimeras amongst their denoised reads , with titanium having more chimeras than sample genotypes ( both algorithms ) , highlighting how essential accurate chimera identification is in tandem with the correction of pcr and sequencing errors .
finally , we found several sequences too far from any sample genotypes or exact chimeras to be explained by being errors away from either .
some of these sequences were similar to previously observed sequences found on genbank ( table 5 ) .
we classified as a contaminant any sequence within 2 nts of a genbank sequence and at least 5 nts closer to a genbank sequence than any sample genotype or chimera .
we found a mixture of contaminants likely to come from the original sample ( lake water bacteria ) , and contaminants that may have entered the sample during processing and sequencing ( bacteria previously observed in human skin , a human mouth , and soil samples ) .
these contaminants were not previously mentioned in q11 but were straightforward to detect when looking at dada 's denoised sequences , in part because having a smaller pool of algorithmic false positives makes identifying contaminants much easier .
table 5 contaminants accession reads / frequency dgb dsample dchim source type dada an divergent fr697039 14 / 4x10 - 4 0 11 10 lake water bacterium y y eu633742 1 / 3x10 - 5 1 9 9 showerhead methylobacter y y jf515955 1 / 3x10 - 5 1 8 8 soil nitrosomonadaceae n y titanium fj004768 77 / 3x10 - 3 2 39 27 soil bacterium y y jf190756 1 / 4x10 - 5 1 40 27 human skin bacterium y y jq462329 2 / 8x10 - 5 0 7 5 human mouth bacterium y n dgb , dsampleand dchimare the hamming distances to the given genbank entry , the nearest sample genotype , and the optimal chimera for each putative contaminant denoised sequence .
no entries are given for the artificial data set because no likely contaminants were found in the denoised sequences of either algorithm .
the last two columns show which contaminants were present in the denoised sequences of each algorithm (" y " if found and " n " if not found ) .
in classifying false negatives , we sought to evaluate the ability of the algorithms to detect the presence of genuine diversity in the pyrosequencing reads .
however , not all clones used to construct the samples in q11 had exact matches amongst the pyrosequencing reads : one sanger sequence in the artificial data set (# 69 in q11 ) was 29 nts away from the nearest 454 read and one sanger sequence in the titanium data set (# 66 in q11 ) was 61 nts away from the nearest 454 read .
we assumed that these were missing from the 454 data , and they do not contribute to the false negatives of either algorithm .
further , a number of clones were identical to each other up to the point of truncation of the pyrosequencing reads .
finally , a number of the titanium clones differed from each other only by the presence of ns , bases that sanger was unable to resolve .
in such cases , we collapsed clones together and assumed the non - n containing sanger sequence was correct .
table 6 gives the number of distinct ( up to ns ) clones that are present in the data , and how many had been used to construct the sample .
table 6 detectable genotypes sample genotypes present and distinct divergent 23 23 artificial 90 50 titanium 91 80 the number of genotypes used to construct the sample and the number that were present and distinct and so could detected by a denoising algorithm .
several aspects of this post - processing pipeline - especially contaminant identification - utilize knowledge of the sample genotypes and do not constitute useful methods for non - test data .
our approach to chimera identification does not utilize sample genotype information , but requires more development to be applied to non - test data : it does not search for higher - order chimeras that are combinations of three or more parental sequences , the criteria for being labelled as a chimera do not scale with error rates and read lengths , and no attempt has been made to realistically model the chimera formation process .
our goal has been only the isolation of errors due to pcr and sequencing error .
appendix 2 : omegaarobustness to assess whether dada 's performance in this paper was the result of the fine - tuning of omegaa , we evaluated each data set under all three omegaavalues .
the results are given in table 7 and demonstrate that the same results would have been achieved by using omegaa = 10 - 100 for all three data sets .
table 7 false positives and false negatives for each data set with omegaa = { 10 - 15,10 - 40,10 - 100 } and omegar = 10 - 3 divergent artificial titanium omegaa false pos false neg false pos false neg false pos false neg 10 - 15 0 0 10 2 7 0 10 - 40 0 0 1 2 6 0 10 - 100 0 0 1 2 6 0 competing interests the authors declare that they have no competing interests .
authors' contributions mjr designed the algorithm , wrote the software , performed the analyses , and wrote the paper .
bjc , dsf , and sph provided assistance and advice with algorithm design , comparative analysis , and the paper .
all authors read and approved the final manuscript .
acknowledgements thanks to chris quince and sue huse for providing and helping with clarifications about test data .
thanks also to yijun sun for help with the esprit clustering algorithm .
finally , thanks again to chris quince and to kabir peay for useful comments on the manuscript .
this work was supported in part by the nsf under grant dms - 1120699 .
sh is supported by grant nih - r01gm086884 .
cheung mk au ch chu kh kwan hs wong ck composition and genetic diversity of picoeukaryotes in subtropic coastal waters as revealed by 454 pyrosequencing isme j 2010 4 1053 1059 10.1038 / ismej.2010.26 20336159 iwai s chai b sul wj cole jr hashsham sa tiedje jm gene - targeted - metagenomics reveals extensive diversity of aromatic dioxygenase genes in the environment isme j 2010 4 279 285 10.1038 / ismej.2009.104 19776767 teixeria lcrs peixoto rs cury jc sul wj pellizari vh tiedje j rosado as bacterial diversity in rhizosphere soil from antarctic vascular plants of admiralty bay , maritime antarctica isme j 2010 4 989 1001 10.1038 / ismej.2010.35 20357834 huse sm dethlefsen l huber ja welch dm relman da sogin ml exploring microbial diversity and taxonomy using ssu rrna hypervariable tag sequencing plos genet 2008 4 e1000255 10.1371 / journal.pgen.1000255 19023400 wilmes p simmons sl denef vj banfield jf the dynamic genetic repertoire of microbial communities fems microbiol rev 2009 33 109 132 10.1111 / j.1574 - 6976.2008.00144.x 19054116 huber ja mark welch db morrison hg huse sm neal pr butterfield da sogin ml microbial population structures in the deep marine biosphere science 2007 318 97 100 10.1126 / science.1146689 17916733 turnbaugh pj quince c faith jj mchardy ac yatsunenko t niazi f affourtit j egholm m henrissat b knight r gordon ji organismal , genetic , and transcriptional variation in the deeply sequenced gut microbiomes of identical twins pnas 2010 107 7503 7507 10.1073 / pnas.1002355107 20363958 sogin ml morrison hg huber ja welch dm huse sm neal pr arrieta jm herndl gj microbial diversity in the deep sea and the underexplored rare biosphere pnas 2006 103 12115 12120 10.1073 / pnas.0605127103 16880384 kunan v engelbrektson a ochman h hugenholtz p wrinkles in the rare biosphere : pyrosequencing errors can lead to artificial inflation of diversity estimates environ microbiol 2010 12 118 123 10.1111 / j.1462 - 2920.2009.02051.x 19725865 zhou j wu l deng y zhi x jiang y tu q xie j nostrand jdv he z yang y reproducibility and quantitation of amplicon sequencing - based detection isme j 2011 5 1303 1313 10.1038 / ismej.2011.11 21346791 huse sm welch dm morrison hg sogin ml ironing out the wrinkles in the rare biosphere through improved otu clustering environ microbiol 2010 12 1889 1898 10.1111 / j.1462 - 2920.2010.02193.x 20236171 reeder j knight r rapidly denoising pyrosequencing amplicon reads by exploiting rank - abundance distributions nat methods 2010 7 668 669 20805793 quince c lanzen a curtis tp davenport rj hall n head ia read lf sloan wt accurate determination of microbial diversity from 454 pyrosequencing data nat methods 2009 6 639 641 10.1038 / nmeth.1361 19668203 quince c lanzen a davenport rj turnbaugh pj removing noise from pyrosequenced amplicons bmc bioinf 2011 12 38 10.1186 / 1471 - 2105 - 12 - 38 michael rosen dada website 2012 http :// sites.google.com / site / dadadenoiser sun y cai y yu f farrell mf mckendree w farmerie w esprit : estimating species richness using large collections of 16s rrna pyrosequences nucleic acids res 2009 37 e76 10.1093 / nar / gkp285 19417062 huse sm huber ja morrison hg sogin ml welch dm accuracy and quality of massively parallel dna pyrosequencing genome biol 2007 8 r143 10.1186 / gb - 2007 - 8 - 7 - r143 17659080 cai y sun y esprit - tree : hierarchical clustering analysis of millions of 16s rrna pyrosequences in quasilinear computational time nucleic acids res 2011 39 e95 10.1093 / nar / gkr349 21596775 needleman sb wunsch cd a general method applicable to the search for similarities in the amino acid sequences of two proteins j mol biol 1970 48 443 453 10.1016 / 0022 - 2836 ( 70 ) 90057 - 4 5420325 fraley c raftery ae how many clusters ?
which clustering method ?
answers via model - based cluster analysis comput j 1998 41 578 588 10.1093 / comjnl / 41.8.578 yang x aluru s dorman ks repeat - aware modeling and correction of short read errors bmc bioinf 2011 12 s52 10.1186 / 1471 - 2105 - 12 - s1 - s52 boyd sd marshall el merker jd maniar jm zhang ln sahaf b jones cd simen bb hanczaruk b nguyen kd nadeau kc egholm m miklos db zehnder jl fire az measurement and clinical monitoring of human lymphocyte clonality by massively parallel vdj pyrosequencing sci translational med 2009 1 12ra23 10.1126 / scitranslmed.3000540 wang c sanders cm yang q schroeder hw wang e babrzadeh f gharizadeh b myers rm hudson jr davis rw han j high throughput sequencing reveals a complex pattern of dynamic interrelationships among human t cell subsets pnas 2009 107 1518 1523 20080641 todd lowe nuc.4.4 score matrix , ncbi 1992 ftp :// ftp.ncbi.nih.gov / blast / matrices / nuc.4.4 lahr djg katz la reducing the impact of pcr - mediated recombination in molecular evolution and environmental studies using a new - generation high - fidelity dna polymerase biotechniques 2009 47 857 866 19852769